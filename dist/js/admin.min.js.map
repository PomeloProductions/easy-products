{"version":3,"sources":["node_modules/browser-pack/_prelude.js","assets/js/admin/classes/Components/ShippingRate.js","assets/js/admin/classes/Components/ShippingRateTemplate.js","assets/js/admin/classes/ProductsList.js","assets/js/admin/classes/ShippingRatesManager.js","assets/js/admin/main.js","node_modules/jquery-sortable/source/js/jquery-sortable.js"],"names":[],"mappings":"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;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"admin.min.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","/**\n * Created by bryce on 3/17/17.\n */\n\nexport class ShippingRate {\n\n    /**\n     * Creates a new instance of a shipping rate\n     *\n     * @param domNode Node\n     */\n    constructor (domNode) {\n\n        this.node = domNode;\n\n        let removeButton = this.node.querySelector('.remote_rate');\n\n        removeButton.addEventListener('click', this.remove.bind(this));\n    }\n\n    /**\n     * Removes this rate from the page\n     *\n     * @param event Event\n     */\n    remove (event) {\n\n        if (event) {\n            event.preventDefault();\n        }\n\n        this.node.parentNode.removeChild(this.node);\n    }\n\n}","/**\n * Created by bryce on 3/17/17.\n */\n\nexport class ShippingRateTemplate {\n\n    /**\n     * Creates a new template holder for easily duplicating the shipping rate template\n     *\n     * @param templateContent Node\n     */\n    constructor(templateContent) {\n\n        this.template = templateContent.cloneNode(true);\n\n        let regionSelect = this.template.querySelector('.shipping_rate-region');\n\n        let options = regionSelect.getElementsByTagName('option');\n\n        for (let i = 0; i < options.length; i++) {\n            if (i != 0) {\n                options[i].removeAttribute('selected');\n            }\n        }\n\n        let inputs = this.template.getElementsByTagName('input');\n\n        for (let i = 0; i < inputs.length; i++) {\n            inputs[i].value = '';\n        }\n\n    }\n\n    /**\n     * Clones the template, so a new node can be added to the page\n     *\n     * @returns {Node}\n     */\n    cloneTemplate () {\n        return this.template.cloneNode(true);\n    }\n}","/**\n * Created by bryce on 3/17/17.\n */\n\nimport 'jquery-sortable';\n\nexport class ProductsList {\n\n    constructor(productsTable) {\n\n        this.products = document.getElementsByClassName('crud_rows');\n        jQuery(productsTable).find('tbody').sortable({\n            itemSelector: 'tr'\n        });\n\n        jQuery(productsTable).find('tr').on('mouseup', this.reorderedProducts.bind(this));\n        jQuery(productsTable).find('tr').on('touchend', this.reorderedProducts.bind(this));\n    }\n\n    /**\n     * Reorders the products on the server\n     */\n    reorderedProducts () {\n\n        setTimeout(function() {\n            let newOrder = [];\n\n            for (let i = 0; i < this.products.length; i++) {\n                newOrder.push(this.products[i].dataset['id']);\n            }\n\n            console.log(newOrder);\n            jQuery.ajax('/wp-admin/admin-ajax.php', {\n                method: 'POST',\n                data: {\n                    action: 'reorder_products',\n                    order: newOrder\n                }\n            });\n        }.bind(this), 10);\n    }\n}","/**\n * Created by bryce on 3/17/17.\n */\n\nimport {ShippingRate} from './Components/ShippingRate';\nimport {ShippingRateTemplate} from './Components/ShippingRateTemplate';\n\nexport class ShippingRatesManager {\n\n    /**\n     * Creates a new shipping rate manager for keeping track of all shipping rates\n     *\n     * @param shippingRatesList Node\n     */\n    constructor (shippingRatesList) {\n\n        this.shippingRateList = shippingRatesList;\n\n        let shippingRates = document.getElementsByClassName('shipping_rate_specific');\n\n        if (!shippingRates.length) {\n            throw error('No shipping rates found on this page');\n        }\n\n        for (let i = 0; i < shippingRates.length; i++) {\n            new ShippingRate(shippingRates[i]);\n        }\n\n        this.template = new ShippingRateTemplate(shippingRates[0]);\n\n        let addButton = document.querySelector('#btn_add_shipping_rate');\n\n        addButton.addEventListener('click', this.addShippingRate.bind(this));\n    }\n\n    /**\n     * Adds a shipping rate to the page\n     *\n     * @param event Event\n     */\n    addShippingRate (event) {\n        if (event) {\n            event.preventDefault();\n        }\n\n        let newNode = this.template.cloneTemplate();\n\n        new ShippingRate(newNode);\n\n        this.shippingRateList.appendChild(newNode);\n    }\n}","/**\r\n * Created by bryce on 2/8/17.\r\n */\r\nimport {ShippingRatesManager} from './classes/ShippingRatesManager';\r\nimport {ProductsList} from './classes/ProductsList';\r\n\r\njQuery(document).ready(function($){\r\n    $('#upload-btn').click(function(e) {\r\n        e.preventDefault();\r\n        var image = wp.media({\r\n            title: 'Upload Image',\r\n            // mutiple: true if you want to upload multiple files at once\r\n            multiple: false\r\n        }).open()\r\n            .on('select', function(e){\r\n                // This will return the selected image from the Media Uploader, the result is an object\r\n                var uploaded_image = image.state().get('selection').first();\r\n                // We convert uploaded_image to a JSON object to make accessing it easier\r\n                // Output to the console uploaded_image\r\n                console.log(uploaded_image);\r\n                var image_url = uploaded_image.toJSON().url;\r\n                // Let's assign the url value to the input field\r\n                $('#image_url').val(image_url);\r\n            });\r\n    });\r\n\r\n    let shippingRatesList = document.getElementById('shipping_rates');\r\n\r\n    if (shippingRatesList != null) {\r\n        new ShippingRatesManager(shippingRatesList);\r\n    }\r\n\r\n    let productsList = document.getElementById('admin-wordwrap_crud');\r\n\r\n    if (typeof productsList != 'undefined') {\r\n        new ProductsList(productsList);\r\n    }\r\n});","/* ===================================================\r\n *  jquery-sortable.js v0.9.13\r\n *  http://johnny.github.com/jquery-sortable/\r\n * ===================================================\r\n *  Copyright (c) 2012 Jonas von Andrian\r\n *  All rights reserved.\r\n *\r\n *  Redistribution and use in source and binary forms, with or without\r\n *  modification, are permitted provided that the following conditions are met:\r\n *  * Redistributions of source code must retain the above copyright\r\n *    notice, this list of conditions and the following disclaimer.\r\n *  * Redistributions in binary form must reproduce the above copyright\r\n *    notice, this list of conditions and the following disclaimer in the\r\n *    documentation and/or other materials provided with the distribution.\r\n *  * The name of the author may not be used to endorse or promote products\r\n *    derived from this software without specific prior written permission.\r\n *\r\n *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\r\n *  ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\r\n *  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\r\n *  DISCLAIMED. IN NO EVENT SHALL <COPYRIGHT HOLDER> BE LIABLE FOR ANY\r\n *  DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\r\n *  (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\r\n *  LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\r\n *  ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n *  (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\r\n *  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n * ========================================================== */\r\n\r\n!function ( $, window, pluginName, undefined){\r\n  var containerDefaults = {\r\n    // If true, items can be dragged from this container\r\n    drag: true,\r\n    // If true, items can be droped onto this container\r\n    drop: true,\r\n    // Exclude items from being draggable, if the\r\n    // selector matches the item\r\n    exclude: \"\",\r\n    // If true, search for nested containers within an item.If you nest containers,\r\n    // either the original selector with which you call the plugin must only match the top containers,\r\n    // or you need to specify a group (see the bootstrap nav example)\r\n    nested: true,\r\n    // If true, the items are assumed to be arranged vertically\r\n    vertical: true\r\n  }, // end container defaults\r\n  groupDefaults = {\r\n    // This is executed after the placeholder has been moved.\r\n    // $closestItemOrContainer contains the closest item, the placeholder\r\n    // has been put at or the closest empty Container, the placeholder has\r\n    // been appended to.\r\n    afterMove: function ($placeholder, container, $closestItemOrContainer) {\r\n    },\r\n    // The exact css path between the container and its items, e.g. \"> tbody\"\r\n    containerPath: \"\",\r\n    // The css selector of the containers\r\n    containerSelector: \"ol, ul\",\r\n    // Distance the mouse has to travel to start dragging\r\n    distance: 0,\r\n    // Time in milliseconds after mousedown until dragging should start.\r\n    // This option can be used to prevent unwanted drags when clicking on an element.\r\n    delay: 0,\r\n    // The css selector of the drag handle\r\n    handle: \"\",\r\n    // The exact css path between the item and its subcontainers.\r\n    // It should only match the immediate items of a container.\r\n    // No item of a subcontainer should be matched. E.g. for ol>div>li the itemPath is \"> div\"\r\n    itemPath: \"\",\r\n    // The css selector of the items\r\n    itemSelector: \"li\",\r\n    // The class given to \"body\" while an item is being dragged\r\n    bodyClass: \"dragging\",\r\n    // The class giving to an item while being dragged\r\n    draggedClass: \"dragged\",\r\n    // Check if the dragged item may be inside the container.\r\n    // Use with care, since the search for a valid container entails a depth first search\r\n    // and may be quite expensive.\r\n    isValidTarget: function ($item, container) {\r\n      return true\r\n    },\r\n    // Executed before onDrop if placeholder is detached.\r\n    // This happens if pullPlaceholder is set to false and the drop occurs outside a container.\r\n    onCancel: function ($item, container, _super, event) {\r\n    },\r\n    // Executed at the beginning of a mouse move event.\r\n    // The Placeholder has not been moved yet.\r\n    onDrag: function ($item, position, _super, event) {\r\n      $item.css(position)\r\n    },\r\n    // Called after the drag has been started,\r\n    // that is the mouse button is being held down and\r\n    // the mouse is moving.\r\n    // The container is the closest initialized container.\r\n    // Therefore it might not be the container, that actually contains the item.\r\n    onDragStart: function ($item, container, _super, event) {\r\n      $item.css({\r\n        height: $item.outerHeight(),\r\n        width: $item.outerWidth()\r\n      })\r\n      $item.addClass(container.group.options.draggedClass)\r\n      $(\"body\").addClass(container.group.options.bodyClass)\r\n    },\r\n    // Called when the mouse button is being released\r\n    onDrop: function ($item, container, _super, event) {\r\n      $item.removeClass(container.group.options.draggedClass).removeAttr(\"style\")\r\n      $(\"body\").removeClass(container.group.options.bodyClass)\r\n    },\r\n    // Called on mousedown. If falsy value is returned, the dragging will not start.\r\n    // Ignore if element clicked is input, select or textarea\r\n    onMousedown: function ($item, _super, event) {\r\n      if (!event.target.nodeName.match(/^(input|select|textarea)$/i)) {\r\n        event.preventDefault()\r\n        return true\r\n      }\r\n    },\r\n    // The class of the placeholder (must match placeholder option markup)\r\n    placeholderClass: \"placeholder\",\r\n    // Template for the placeholder. Can be any valid jQuery input\r\n    // e.g. a string, a DOM element.\r\n    // The placeholder must have the class \"placeholder\"\r\n    placeholder: '<li class=\"placeholder\"></li>',\r\n    // If true, the position of the placeholder is calculated on every mousemove.\r\n    // If false, it is only calculated when the mouse is above a container.\r\n    pullPlaceholder: true,\r\n    // Specifies serialization of the container group.\r\n    // The pair $parent/$children is either container/items or item/subcontainers.\r\n    serialize: function ($parent, $children, parentIsContainer) {\r\n      var result = $.extend({}, $parent.data())\r\n\r\n      if(parentIsContainer)\r\n        return [$children]\r\n      else if ($children[0]){\r\n        result.children = $children\r\n      }\r\n\r\n      delete result.subContainers\r\n      delete result.sortable\r\n\r\n      return result\r\n    },\r\n    // Set tolerance while dragging. Positive values decrease sensitivity,\r\n    // negative values increase it.\r\n    tolerance: 0\r\n  }, // end group defaults\r\n  containerGroups = {},\r\n  groupCounter = 0,\r\n  emptyBox = {\r\n    left: 0,\r\n    top: 0,\r\n    bottom: 0,\r\n    right:0\r\n  },\r\n  eventNames = {\r\n    start: \"touchstart.sortable mousedown.sortable\",\r\n    drop: \"touchend.sortable touchcancel.sortable mouseup.sortable\",\r\n    drag: \"touchmove.sortable mousemove.sortable\",\r\n    scroll: \"scroll.sortable\"\r\n  },\r\n  subContainerKey = \"subContainers\"\r\n\r\n  /*\r\n   * a is Array [left, right, top, bottom]\r\n   * b is array [left, top]\r\n   */\r\n  function d(a,b) {\r\n    var x = Math.max(0, a[0] - b[0], b[0] - a[1]),\r\n    y = Math.max(0, a[2] - b[1], b[1] - a[3])\r\n    return x+y;\r\n  }\r\n\r\n  function setDimensions(array, dimensions, tolerance, useOffset) {\r\n    var i = array.length,\r\n    offsetMethod = useOffset ? \"offset\" : \"position\"\r\n    tolerance = tolerance || 0\r\n\r\n    while(i--){\r\n      var el = array[i].el ? array[i].el : $(array[i]),\r\n      // use fitting method\r\n      pos = el[offsetMethod]()\r\n      pos.left += parseInt(el.css('margin-left'), 10)\r\n      pos.top += parseInt(el.css('margin-top'),10)\r\n      dimensions[i] = [\r\n        pos.left - tolerance,\r\n        pos.left + el.outerWidth() + tolerance,\r\n        pos.top - tolerance,\r\n        pos.top + el.outerHeight() + tolerance\r\n      ]\r\n    }\r\n  }\r\n\r\n  function getRelativePosition(pointer, element) {\r\n    var offset = element.offset()\r\n    return {\r\n      left: pointer.left - offset.left,\r\n      top: pointer.top - offset.top\r\n    }\r\n  }\r\n\r\n  function sortByDistanceDesc(dimensions, pointer, lastPointer) {\r\n    pointer = [pointer.left, pointer.top]\r\n    lastPointer = lastPointer && [lastPointer.left, lastPointer.top]\r\n\r\n    var dim,\r\n    i = dimensions.length,\r\n    distances = []\r\n\r\n    while(i--){\r\n      dim = dimensions[i]\r\n      distances[i] = [i,d(dim,pointer), lastPointer && d(dim, lastPointer)]\r\n    }\r\n    distances = distances.sort(function  (a,b) {\r\n      return b[1] - a[1] || b[2] - a[2] || b[0] - a[0]\r\n    })\r\n\r\n    // last entry is the closest\r\n    return distances\r\n  }\r\n\r\n  function ContainerGroup(options) {\r\n    this.options = $.extend({}, groupDefaults, options)\r\n    this.containers = []\r\n\r\n    if(!this.options.rootGroup){\r\n      this.scrollProxy = $.proxy(this.scroll, this)\r\n      this.dragProxy = $.proxy(this.drag, this)\r\n      this.dropProxy = $.proxy(this.drop, this)\r\n      this.placeholder = $(this.options.placeholder)\r\n\r\n      if(!options.isValidTarget)\r\n        this.options.isValidTarget = undefined\r\n    }\r\n  }\r\n\r\n  ContainerGroup.get = function  (options) {\r\n    if(!containerGroups[options.group]) {\r\n      if(options.group === undefined)\r\n        options.group = groupCounter ++\r\n\r\n      containerGroups[options.group] = new ContainerGroup(options)\r\n    }\r\n\r\n    return containerGroups[options.group]\r\n  }\r\n\r\n  ContainerGroup.prototype = {\r\n    dragInit: function  (e, itemContainer) {\r\n      this.$document = $(itemContainer.el[0].ownerDocument)\r\n\r\n      // get item to drag\r\n      var closestItem = $(e.target).closest(this.options.itemSelector);\r\n      // using the length of this item, prevents the plugin from being started if there is no handle being clicked on.\r\n      // this may also be helpful in instantiating multidrag.\r\n      if (closestItem.length) {\r\n        this.item = closestItem;\r\n        this.itemContainer = itemContainer;\r\n        if (this.item.is(this.options.exclude) || !this.options.onMousedown(this.item, groupDefaults.onMousedown, e)) {\r\n            return;\r\n        }\r\n        this.setPointer(e);\r\n        this.toggleListeners('on');\r\n        this.setupDelayTimer();\r\n        this.dragInitDone = true;\r\n      }\r\n    },\r\n    drag: function  (e) {\r\n      if(!this.dragging){\r\n        if(!this.distanceMet(e) || !this.delayMet)\r\n          return\r\n\r\n        this.options.onDragStart(this.item, this.itemContainer, groupDefaults.onDragStart, e)\r\n        this.item.before(this.placeholder)\r\n        this.dragging = true\r\n      }\r\n\r\n      this.setPointer(e)\r\n      // place item under the cursor\r\n      this.options.onDrag(this.item,\r\n                          getRelativePosition(this.pointer, this.item.offsetParent()),\r\n                          groupDefaults.onDrag,\r\n                          e)\r\n\r\n      var p = this.getPointer(e),\r\n      box = this.sameResultBox,\r\n      t = this.options.tolerance\r\n\r\n      if(!box || box.top - t > p.top || box.bottom + t < p.top || box.left - t > p.left || box.right + t < p.left)\r\n        if(!this.searchValidTarget()){\r\n          this.placeholder.detach()\r\n          this.lastAppendedItem = undefined\r\n        }\r\n    },\r\n    drop: function  (e) {\r\n      this.toggleListeners('off')\r\n\r\n      this.dragInitDone = false\r\n\r\n      if(this.dragging){\r\n        // processing Drop, check if placeholder is detached\r\n        if(this.placeholder.closest(\"html\")[0]){\r\n          this.placeholder.before(this.item).detach()\r\n        } else {\r\n          this.options.onCancel(this.item, this.itemContainer, groupDefaults.onCancel, e)\r\n        }\r\n        this.options.onDrop(this.item, this.getContainer(this.item), groupDefaults.onDrop, e)\r\n\r\n        // cleanup\r\n        this.clearDimensions()\r\n        this.clearOffsetParent()\r\n        this.lastAppendedItem = this.sameResultBox = undefined\r\n        this.dragging = false\r\n      }\r\n    },\r\n    searchValidTarget: function  (pointer, lastPointer) {\r\n      if(!pointer){\r\n        pointer = this.relativePointer || this.pointer\r\n        lastPointer = this.lastRelativePointer || this.lastPointer\r\n      }\r\n\r\n      var distances = sortByDistanceDesc(this.getContainerDimensions(),\r\n                                         pointer,\r\n                                         lastPointer),\r\n      i = distances.length\r\n\r\n      while(i--){\r\n        var index = distances[i][0],\r\n        distance = distances[i][1]\r\n\r\n        if(!distance || this.options.pullPlaceholder){\r\n          var container = this.containers[index]\r\n          if(!container.disabled){\r\n            if(!this.$getOffsetParent()){\r\n              var offsetParent = container.getItemOffsetParent()\r\n              pointer = getRelativePosition(pointer, offsetParent)\r\n              lastPointer = getRelativePosition(lastPointer, offsetParent)\r\n            }\r\n            if(container.searchValidTarget(pointer, lastPointer))\r\n              return true\r\n          }\r\n        }\r\n      }\r\n      if(this.sameResultBox)\r\n        this.sameResultBox = undefined\r\n    },\r\n    movePlaceholder: function  (container, item, method, sameResultBox) {\r\n      var lastAppendedItem = this.lastAppendedItem\r\n      if(!sameResultBox && lastAppendedItem && lastAppendedItem[0] === item[0])\r\n        return;\r\n\r\n      item[method](this.placeholder)\r\n      this.lastAppendedItem = item\r\n      this.sameResultBox = sameResultBox\r\n      this.options.afterMove(this.placeholder, container, item)\r\n    },\r\n    getContainerDimensions: function  () {\r\n      if(!this.containerDimensions)\r\n        setDimensions(this.containers, this.containerDimensions = [], this.options.tolerance, !this.$getOffsetParent())\r\n      return this.containerDimensions\r\n    },\r\n    getContainer: function  (element) {\r\n      return element.closest(this.options.containerSelector).data(pluginName)\r\n    },\r\n    $getOffsetParent: function  () {\r\n      if(this.offsetParent === undefined){\r\n        var i = this.containers.length - 1,\r\n        offsetParent = this.containers[i].getItemOffsetParent()\r\n\r\n        if(!this.options.rootGroup){\r\n          while(i--){\r\n            if(offsetParent[0] != this.containers[i].getItemOffsetParent()[0]){\r\n              // If every container has the same offset parent,\r\n              // use position() which is relative to this parent,\r\n              // otherwise use offset()\r\n              // compare #setDimensions\r\n              offsetParent = false\r\n              break;\r\n            }\r\n          }\r\n        }\r\n\r\n        this.offsetParent = offsetParent\r\n      }\r\n      return this.offsetParent\r\n    },\r\n    setPointer: function (e) {\r\n      var pointer = this.getPointer(e)\r\n\r\n      if(this.$getOffsetParent()){\r\n        var relativePointer = getRelativePosition(pointer, this.$getOffsetParent())\r\n        this.lastRelativePointer = this.relativePointer\r\n        this.relativePointer = relativePointer\r\n      }\r\n\r\n      this.lastPointer = this.pointer\r\n      this.pointer = pointer\r\n    },\r\n    distanceMet: function (e) {\r\n      var currentPointer = this.getPointer(e)\r\n      return (Math.max(\r\n        Math.abs(this.pointer.left - currentPointer.left),\r\n        Math.abs(this.pointer.top - currentPointer.top)\r\n      ) >= this.options.distance)\r\n    },\r\n    getPointer: function(e) {\r\n      var o = e.originalEvent || e.originalEvent.touches && e.originalEvent.touches[0]\r\n      return {\r\n        left: e.pageX || o.pageX,\r\n        top: e.pageY || o.pageY\r\n      }\r\n    },\r\n    setupDelayTimer: function () {\r\n      var that = this\r\n      this.delayMet = !this.options.delay\r\n\r\n      // init delay timer if needed\r\n      if (!this.delayMet) {\r\n        clearTimeout(this._mouseDelayTimer);\r\n        this._mouseDelayTimer = setTimeout(function() {\r\n          that.delayMet = true\r\n        }, this.options.delay)\r\n      }\r\n    },\r\n    scroll: function  (e) {\r\n      this.clearDimensions()\r\n      this.clearOffsetParent() // TODO is this needed?\r\n    },\r\n    toggleListeners: function (method) {\r\n      var that = this,\r\n      events = ['drag','drop','scroll']\r\n\r\n      $.each(events,function  (i,event) {\r\n        that.$document[method](eventNames[event], that[event + 'Proxy'])\r\n      })\r\n    },\r\n    clearOffsetParent: function () {\r\n      this.offsetParent = undefined\r\n    },\r\n    // Recursively clear container and item dimensions\r\n    clearDimensions: function  () {\r\n      this.traverse(function(object){\r\n        object._clearDimensions()\r\n      })\r\n    },\r\n    traverse: function(callback) {\r\n      callback(this)\r\n      var i = this.containers.length\r\n      while(i--){\r\n        this.containers[i].traverse(callback)\r\n      }\r\n    },\r\n    _clearDimensions: function(){\r\n      this.containerDimensions = undefined\r\n    },\r\n    _destroy: function () {\r\n      containerGroups[this.options.group] = undefined\r\n    }\r\n  }\r\n\r\n  function Container(element, options) {\r\n    this.el = element\r\n    this.options = $.extend( {}, containerDefaults, options)\r\n\r\n    this.group = ContainerGroup.get(this.options)\r\n    this.rootGroup = this.options.rootGroup || this.group\r\n    this.handle = this.rootGroup.options.handle || this.rootGroup.options.itemSelector\r\n\r\n    var itemPath = this.rootGroup.options.itemPath\r\n    this.target = itemPath ? this.el.find(itemPath) : this.el\r\n\r\n    this.target.on(eventNames.start, this.handle, $.proxy(this.dragInit, this))\r\n\r\n    if(this.options.drop)\r\n      this.group.containers.push(this)\r\n  }\r\n\r\n  Container.prototype = {\r\n    dragInit: function  (e) {\r\n      var rootGroup = this.rootGroup\r\n\r\n      if( !this.disabled &&\r\n          !rootGroup.dragInitDone &&\r\n          this.options.drag &&\r\n          this.isValidDrag(e)) {\r\n        rootGroup.dragInit(e, this)\r\n      }\r\n    },\r\n    isValidDrag: function(e) {\r\n      return e.which == 1 ||\r\n        e.type == \"touchstart\" && e.originalEvent.touches.length == 1\r\n    },\r\n    searchValidTarget: function  (pointer, lastPointer) {\r\n      var distances = sortByDistanceDesc(this.getItemDimensions(),\r\n                                         pointer,\r\n                                         lastPointer),\r\n      i = distances.length,\r\n      rootGroup = this.rootGroup,\r\n      validTarget = !rootGroup.options.isValidTarget ||\r\n        rootGroup.options.isValidTarget(rootGroup.item, this)\r\n\r\n      if(!i && validTarget){\r\n        rootGroup.movePlaceholder(this, this.target, \"append\")\r\n        return true\r\n      } else\r\n        while(i--){\r\n          var index = distances[i][0],\r\n          distance = distances[i][1]\r\n          if(!distance && this.hasChildGroup(index)){\r\n            var found = this.getContainerGroup(index).searchValidTarget(pointer, lastPointer)\r\n            if(found)\r\n              return true\r\n          }\r\n          else if(validTarget){\r\n            this.movePlaceholder(index, pointer)\r\n            return true\r\n          }\r\n        }\r\n    },\r\n    movePlaceholder: function  (index, pointer) {\r\n      var item = $(this.items[index]),\r\n      dim = this.itemDimensions[index],\r\n      method = \"after\",\r\n      width = item.outerWidth(),\r\n      height = item.outerHeight(),\r\n      offset = item.offset(),\r\n      sameResultBox = {\r\n        left: offset.left,\r\n        right: offset.left + width,\r\n        top: offset.top,\r\n        bottom: offset.top + height\r\n      }\r\n      if(this.options.vertical){\r\n        var yCenter = (dim[2] + dim[3]) / 2,\r\n        inUpperHalf = pointer.top <= yCenter\r\n        if(inUpperHalf){\r\n          method = \"before\"\r\n          sameResultBox.bottom -= height / 2\r\n        } else\r\n          sameResultBox.top += height / 2\r\n      } else {\r\n        var xCenter = (dim[0] + dim[1]) / 2,\r\n        inLeftHalf = pointer.left <= xCenter\r\n        if(inLeftHalf){\r\n          method = \"before\"\r\n          sameResultBox.right -= width / 2\r\n        } else\r\n          sameResultBox.left += width / 2\r\n      }\r\n      if(this.hasChildGroup(index))\r\n        sameResultBox = emptyBox\r\n      this.rootGroup.movePlaceholder(this, item, method, sameResultBox)\r\n    },\r\n    getItemDimensions: function  () {\r\n      if(!this.itemDimensions){\r\n        this.items = this.$getChildren(this.el, \"item\").filter(\r\n          \":not(.\" + this.group.options.placeholderClass + \", .\" + this.group.options.draggedClass + \")\"\r\n        ).get()\r\n        setDimensions(this.items, this.itemDimensions = [], this.options.tolerance)\r\n      }\r\n      return this.itemDimensions\r\n    },\r\n    getItemOffsetParent: function  () {\r\n      var offsetParent,\r\n      el = this.el\r\n      // Since el might be empty we have to check el itself and\r\n      // can not do something like el.children().first().offsetParent()\r\n      if(el.css(\"position\") === \"relative\" || el.css(\"position\") === \"absolute\"  || el.css(\"position\") === \"fixed\")\r\n        offsetParent = el\r\n      else\r\n        offsetParent = el.offsetParent()\r\n      return offsetParent\r\n    },\r\n    hasChildGroup: function (index) {\r\n      return this.options.nested && this.getContainerGroup(index)\r\n    },\r\n    getContainerGroup: function  (index) {\r\n      var childGroup = $.data(this.items[index], subContainerKey)\r\n      if( childGroup === undefined){\r\n        var childContainers = this.$getChildren(this.items[index], \"container\")\r\n        childGroup = false\r\n\r\n        if(childContainers[0]){\r\n          var options = $.extend({}, this.options, {\r\n            rootGroup: this.rootGroup,\r\n            group: groupCounter ++\r\n          })\r\n          childGroup = childContainers[pluginName](options).data(pluginName).group\r\n        }\r\n        $.data(this.items[index], subContainerKey, childGroup)\r\n      }\r\n      return childGroup\r\n    },\r\n    $getChildren: function (parent, type) {\r\n      var options = this.rootGroup.options,\r\n      path = options[type + \"Path\"],\r\n      selector = options[type + \"Selector\"]\r\n\r\n      parent = $(parent)\r\n      if(path)\r\n        parent = parent.find(path)\r\n\r\n      return parent.children(selector)\r\n    },\r\n    _serialize: function (parent, isContainer) {\r\n      var that = this,\r\n      childType = isContainer ? \"item\" : \"container\",\r\n\r\n      children = this.$getChildren(parent, childType).not(this.options.exclude).map(function () {\r\n        return that._serialize($(this), !isContainer)\r\n      }).get()\r\n\r\n      return this.rootGroup.options.serialize(parent, children, isContainer)\r\n    },\r\n    traverse: function(callback) {\r\n      $.each(this.items || [], function(item){\r\n        var group = $.data(this, subContainerKey)\r\n        if(group)\r\n          group.traverse(callback)\r\n      });\r\n\r\n      callback(this)\r\n    },\r\n    _clearDimensions: function  () {\r\n      this.itemDimensions = undefined\r\n    },\r\n    _destroy: function() {\r\n      var that = this;\r\n\r\n      this.target.off(eventNames.start, this.handle);\r\n      this.el.removeData(pluginName)\r\n\r\n      if(this.options.drop)\r\n        this.group.containers = $.grep(this.group.containers, function(val){\r\n          return val != that\r\n        })\r\n\r\n      $.each(this.items || [], function(){\r\n        $.removeData(this, subContainerKey)\r\n      })\r\n    }\r\n  }\r\n\r\n  var API = {\r\n    enable: function() {\r\n      this.traverse(function(object){\r\n        object.disabled = false\r\n      })\r\n    },\r\n    disable: function (){\r\n      this.traverse(function(object){\r\n        object.disabled = true\r\n      })\r\n    },\r\n    serialize: function () {\r\n      return this._serialize(this.el, true)\r\n    },\r\n    refresh: function() {\r\n      this.traverse(function(object){\r\n        object._clearDimensions()\r\n      })\r\n    },\r\n    destroy: function () {\r\n      this.traverse(function(object){\r\n        object._destroy();\r\n      })\r\n    }\r\n  }\r\n\r\n  $.extend(Container.prototype, API)\r\n\r\n  /**\r\n   * jQuery API\r\n   *\r\n   * Parameters are\r\n   *   either options on init\r\n   *   or a method name followed by arguments to pass to the method\r\n   */\r\n  $.fn[pluginName] = function(methodOrOptions) {\r\n    var args = Array.prototype.slice.call(arguments, 1)\r\n\r\n    return this.map(function(){\r\n      var $t = $(this),\r\n      object = $t.data(pluginName)\r\n\r\n      if(object && API[methodOrOptions])\r\n        return API[methodOrOptions].apply(object, args) || this\r\n      else if(!object && (methodOrOptions === undefined ||\r\n                          typeof methodOrOptions === \"object\"))\r\n        $t.data(pluginName, new Container($t, methodOrOptions))\r\n\r\n      return this\r\n    });\r\n  };\r\n\r\n}(jQuery, window, 'sortable');\r\n"],"preExistingComment":"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJhc3NldHMvanMvYWRtaW4vY2xhc3Nlcy9Db21wb25lbnRzL1NoaXBwaW5nUmF0ZS5qcyIsImFzc2V0cy9qcy9hZG1pbi9jbGFzc2VzL0NvbXBvbmVudHMvU2hpcHBpbmdSYXRlVGVtcGxhdGUuanMiLCJhc3NldHMvanMvYWRtaW4vY2xhc3Nlcy9Qcm9kdWN0c0xpc3QuanMiLCJhc3NldHMvanMvYWRtaW4vY2xhc3Nlcy9TaGlwcGluZ1JhdGVzTWFuYWdlci5qcyIsImFzc2V0cy9qcy9hZG1pbi9tYWluLmpzIiwibm9kZV9tb2R1bGVzL2pxdWVyeS1zb3J0YWJsZS9zb3VyY2UvanMvanF1ZXJ5LXNvcnRhYmxlLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7OztBQ0FBOzs7O0lBSWEsWSxXQUFBLFk7O0FBRVQ7Ozs7O0FBS0EsMEJBQWEsT0FBYixFQUFzQjtBQUFBOztBQUVsQixhQUFLLElBQUwsR0FBWSxPQUFaOztBQUVBLFlBQUksZUFBZSxLQUFLLElBQUwsQ0FBVSxhQUFWLENBQXdCLGNBQXhCLENBQW5COztBQUVBLHFCQUFhLGdCQUFiLENBQThCLE9BQTlCLEVBQXVDLEtBQUssTUFBTCxDQUFZLElBQVosQ0FBaUIsSUFBakIsQ0FBdkM7QUFDSDs7QUFFRDs7Ozs7Ozs7OytCQUtRLEssRUFBTzs7QUFFWCxnQkFBSSxLQUFKLEVBQVc7QUFDUCxzQkFBTSxjQUFOO0FBQ0g7O0FBRUQsaUJBQUssSUFBTCxDQUFVLFVBQVYsQ0FBcUIsV0FBckIsQ0FBaUMsS0FBSyxJQUF0QztBQUNIOzs7Ozs7Ozs7Ozs7Ozs7OztBQ2hDTDs7OztJQUlhLG9CLFdBQUEsb0I7O0FBRVQ7Ozs7O0FBS0Esa0NBQVksZUFBWixFQUE2QjtBQUFBOztBQUV6QixhQUFLLFFBQUwsR0FBZ0IsZ0JBQWdCLFNBQWhCLENBQTBCLElBQTFCLENBQWhCOztBQUVBLFlBQUksZUFBZSxLQUFLLFFB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O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiLyoqXG4gKiBDcmVhdGVkIGJ5IGJyeWNlIG9uIDMvMTcvMTcuXG4gKi9cblxuZXhwb3J0IGNsYXNzIFNoaXBwaW5nUmF0ZSB7XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgbmV3IGluc3RhbmNlIG9mIGEgc2hpcHBpbmcgcmF0ZVxuICAgICAqXG4gICAgICogQHBhcmFtIGRvbU5vZGUgTm9kZVxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yIChkb21Ob2RlKSB7XG5cbiAgICAgICAgdGhpcy5ub2RlID0gZG9tTm9kZTtcblxuICAgICAgICBsZXQgcmVtb3ZlQnV0dG9uID0gdGhpcy5ub2RlLnF1ZXJ5U2VsZWN0b3IoJy5yZW1vdGVfcmF0ZScpO1xuXG4gICAgICAgIHJlbW92ZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMucmVtb3ZlLmJpbmQodGhpcykpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlbW92ZXMgdGhpcyByYXRlIGZyb20gdGhlIHBhZ2VcbiAgICAgKlxuICAgICAqIEBwYXJhbSBldmVudCBFdmVudFxuICAgICAqL1xuICAgIHJlbW92ZSAoZXZlbnQpIHtcblxuICAgICAgICBpZiAoZXZlbnQpIHtcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLm5vZGUucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGlzLm5vZGUpO1xuICAgIH1cblxufSIsIi8qKlxuICogQ3JlYXRlZCBieSBicnljZSBvbiAzLzE3LzE3LlxuICovXG5cbmV4cG9ydCBjbGFzcyBTaGlwcGluZ1JhdGVUZW1wbGF0ZSB7XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgbmV3IHRlbXBsYXRlIGhvbGRlciBmb3IgZWFzaWx5IGR1cGxpY2F0aW5nIHRoZSBzaGlwcGluZyByYXRlIHRlbXBsYXRlXG4gICAgICpcbiAgICAgKiBAcGFyYW0gdGVtcGxhdGVDb250ZW50IE5vZGVcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3Rvcih0ZW1wbGF0ZUNvbnRlbnQpIHtcblxuICAgICAgICB0aGlzLnRlbXBsYXRlID0gdGVtcGxhdGVDb250ZW50LmNsb25lTm9kZSh0cnVlKTtcblxuICAgICAgICBsZXQgcmVnaW9uU2VsZWN0ID0gdGhpcy50ZW1wbGF0ZS5xdWVyeVNlbGVjdG9yKCcuc2hpcHBpbmdfcmF0ZS1yZWdpb24nKTtcblxuICAgICAgICBsZXQgb3B0aW9ucyA9IHJlZ2lvblNlbGVjdC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnb3B0aW9uJyk7XG5cbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBvcHRpb25zLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBpZiAoaSAhPSAwKSB7XG4gICAgICAgICAgICAgICAgb3B0aW9uc1tpXS5yZW1vdmVBdHRyaWJ1dGUoJ3NlbGVjdGVkJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgaW5wdXRzID0gdGhpcy50ZW1wbGF0ZS5nZXRFbGVtZW50c0J5VGFnTmFtZSgnaW5wdXQnKTtcblxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGlucHV0cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgaW5wdXRzW2ldLnZhbHVlID0gJyc7XG4gICAgICAgIH1cblxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENsb25lcyB0aGUgdGVtcGxhdGUsIHNvIGEgbmV3IG5vZGUgY2FuIGJlIGFkZGVkIHRvIHRoZSBwYWdlXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyB7Tm9kZX1cbiAgICAgKi9cbiAgICBjbG9uZVRlbXBsYXRlICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudGVtcGxhdGUuY2xvbmVOb2RlKHRydWUpO1xuICAgIH1cbn0iLCIvKipcbiAqIENyZWF0ZWQgYnkgYnJ5Y2Ugb24gMy8xNy8xNy5cbiAqL1xuXG5pbXBvcnQgJ2pxdWVyeS1zb3J0YWJsZSc7XG5cbmV4cG9ydCBjbGFzcyBQcm9kdWN0c0xpc3Qge1xuXG4gICAgY29uc3RydWN0b3IocHJvZHVjdHNUYWJsZSkge1xuXG4gICAgICAgIHRoaXMucHJvZHVjdHMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdjcnVkX3Jvd3MnKTtcbiAgICAgICAgalF1ZXJ5KHByb2R1Y3RzVGFibGUpLmZpbmQoJ3Rib2R5Jykuc29ydGFibGUoe1xuICAgICAgICAgICAgaXRlbVNlbGVjdG9yOiAndHInXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGpRdWVyeShwcm9kdWN0c1RhYmxlKS5maW5kKCd0cicpLm9uKCdtb3VzZXVwJywgdGhpcy5yZW9yZGVyZWRQcm9kdWN0cy5iaW5kKHRoaXMpKTtcbiAgICAgICAgalF1ZXJ5KHByb2R1Y3RzVGFibGUpLmZpbmQoJ3RyJykub24oJ3RvdWNoZW5kJywgdGhpcy5yZW9yZGVyZWRQcm9kdWN0cy5iaW5kKHRoaXMpKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZW9yZGVycyB0aGUgcHJvZHVjdHMgb24gdGhlIHNlcnZlclxuICAgICAqL1xuICAgIHJlb3JkZXJlZFByb2R1Y3RzICgpIHtcblxuICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgbGV0IG5ld09yZGVyID0gW107XG5cbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5wcm9kdWN0cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIG5ld09yZGVyLnB1c2godGhpcy5wcm9kdWN0c1tpXS5kYXRhc2V0WydpZCddKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29uc29sZS5sb2cobmV3T3JkZXIpO1xuICAgICAgICAgICAgalF1ZXJ5LmFqYXgoJy93cC1hZG1pbi9hZG1pbi1hamF4LnBocCcsIHtcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIGFjdGlvbjogJ3Jlb3JkZXJfcHJvZHVjdHMnLFxuICAgICAgICAgICAgICAgICAgICBvcmRlcjogbmV3T3JkZXJcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfS5iaW5kKHRoaXMpLCAxMCk7XG4gICAgfVxufSIsIi8qKlxuICogQ3JlYXRlZCBieSBicnljZSBvbiAzLzE3LzE3LlxuICovXG5cbmltcG9ydCB7U2hpcHBpbmdSYXRlfSBmcm9tICcuL0NvbXBvbmVudHMvU2hpcHBpbmdSYXRlJztcbmltcG9ydCB7U2hpcHBpbmdSYXRlVGVtcGxhdGV9IGZyb20gJy4vQ29tcG9uZW50cy9TaGlwcGluZ1JhdGVUZW1wbGF0ZSc7XG5cbmV4cG9ydCBjbGFzcyBTaGlwcGluZ1JhdGVzTWFuYWdlciB7XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgbmV3IHNoaXBwaW5nIHJhdGUgbWFuYWdlciBmb3Iga2VlcGluZyB0cmFjayBvZiBhbGwgc2hpcHBpbmcgcmF0ZXNcbiAgICAgKlxuICAgICAqIEBwYXJhbSBzaGlwcGluZ1JhdGVzTGlzdCBOb2RlXG4gICAgICovXG4gICAgY29uc3RydWN0b3IgKHNoaXBwaW5nUmF0ZXNMaXN0KSB7XG5cbiAgICAgICAgdGhpcy5zaGlwcGluZ1JhdGVMaXN0ID0gc2hpcHBpbmdSYXRlc0xpc3Q7XG5cbiAgICAgICAgbGV0IHNoaXBwaW5nUmF0ZXMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdzaGlwcGluZ19yYXRlX3NwZWNpZmljJyk7XG5cbiAgICAgICAgaWYgKCFzaGlwcGluZ1JhdGVzLmxlbmd0aCkge1xuICAgICAgICAgICAgdGhyb3cgZXJyb3IoJ05vIHNoaXBwaW5nIHJhdGVzIGZvdW5kIG9uIHRoaXMgcGFnZScpO1xuICAgICAgICB9XG5cbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzaGlwcGluZ1JhdGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBuZXcgU2hpcHBpbmdSYXRlKHNoaXBwaW5nUmF0ZXNbaV0pO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy50ZW1wbGF0ZSA9IG5ldyBTaGlwcGluZ1JhdGVUZW1wbGF0ZShzaGlwcGluZ1JhdGVzWzBdKTtcblxuICAgICAgICBsZXQgYWRkQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2J0bl9hZGRfc2hpcHBpbmdfcmF0ZScpO1xuXG4gICAgICAgIGFkZEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMuYWRkU2hpcHBpbmdSYXRlLmJpbmQodGhpcykpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEFkZHMgYSBzaGlwcGluZyByYXRlIHRvIHRoZSBwYWdlXG4gICAgICpcbiAgICAgKiBAcGFyYW0gZXZlbnQgRXZlbnRcbiAgICAgKi9cbiAgICBhZGRTaGlwcGluZ1JhdGUgKGV2ZW50KSB7XG4gICAgICAgIGlmIChldmVudCkge1xuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBuZXdOb2RlID0gdGhpcy50ZW1wbGF0ZS5jbG9uZVRlbXBsYXRlKCk7XG5cbiAgICAgICAgbmV3IFNoaXBwaW5nUmF0ZShuZXdOb2RlKTtcblxuICAgICAgICB0aGlzLnNoaXBwaW5nUmF0ZUxpc3QuYXBwZW5kQ2hpbGQobmV3Tm9kZSk7XG4gICAgfVxufSIsIi8qKlxyXG4gKiBDcmVhdGVkIGJ5IGJyeWNlIG9uIDIvOC8xNy5cclxuICovXHJcbmltcG9ydCB7U2hpcHBpbmdSYXRlc01hbmFnZXJ9IGZyb20gJy4vY2xhc3Nlcy9TaGlwcGluZ1JhdGVzTWFuYWdlcic7XHJcbmltcG9ydCB7UHJvZHVjdHNMaXN0fSBmcm9tICcuL2NsYXNzZXMvUHJvZHVjdHNMaXN0JztcclxuXHJcbmpRdWVyeShkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oJCl7XHJcbiAgICAkKCcjdXBsb2FkLWJ0bicpLmNsaWNrKGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgdmFyIGltYWdlID0gd3AubWVkaWEoe1xyXG4gICAgICAgICAgICB0aXRsZTogJ1VwbG9hZCBJbWFnZScsXHJcbiAgICAgICAgICAgIC8vIG11dGlwbGU6IHRydWUgaWYgeW91IHdhbnQgdG8gdXBsb2FkIG11bHRpcGxlIGZpbGVzIGF0IG9uY2VcclxuICAgICAgICAgICAgbXVsdGlwbGU6IGZhbHNlXHJcbiAgICAgICAgfSkub3BlbigpXHJcbiAgICAgICAgICAgIC5vbignc2VsZWN0JywgZnVuY3Rpb24oZSl7XHJcbiAgICAgICAgICAgICAgICAvLyBUaGlzIHdpbGwgcmV0dXJuIHRoZSBzZWxlY3RlZCBpbWFnZSBmcm9tIHRoZSBNZWRpYSBVcGxvYWRlciwgdGhlIHJlc3VsdCBpcyBhbiBvYmplY3RcclxuICAgICAgICAgICAgICAgIHZhciB1cGxvYWRlZF9pbWFnZSA9IGltYWdlLnN0YXRlKCkuZ2V0KCdzZWxlY3Rpb24nKS5maXJzdCgpO1xyXG4gICAgICAgICAgICAgICAgLy8gV2UgY29udmVydCB1cGxvYWRlZF9pbWFnZSB0byBhIEpTT04gb2JqZWN0IHRvIG1ha2UgYWNjZXNzaW5nIGl0IGVhc2llclxyXG4gICAgICAgICAgICAgICAgLy8gT3V0cHV0IHRvIHRoZSBjb25zb2xlIHVwbG9hZGVkX2ltYWdlXHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyh1cGxvYWRlZF9pbWFnZSk7XHJcbiAgICAgICAgICAgICAgICB2YXIgaW1hZ2VfdXJsID0gdXBsb2FkZWRfaW1hZ2UudG9KU09OKCkudXJsO1xyXG4gICAgICAgICAgICAgICAgLy8gTGV0J3MgYXNzaWduIHRoZSB1cmwgdmFsdWUgdG8gdGhlIGlucHV0IGZpZWxkXHJcbiAgICAgICAgICAgICAgICAkKCcjaW1hZ2VfdXJsJykudmFsKGltYWdlX3VybCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgbGV0IHNoaXBwaW5nUmF0ZXNMaXN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NoaXBwaW5nX3JhdGVzJyk7XHJcblxyXG4gICAgaWYgKHNoaXBwaW5nUmF0ZXNMaXN0ICE9IG51bGwpIHtcclxuICAgICAgICBuZXcgU2hpcHBpbmdSYXRlc01hbmFnZXIoc2hpcHBpbmdSYXRlc0xpc3QpO1xyXG4gICAgfVxyXG5cclxuICAgIGxldCBwcm9kdWN0c0xpc3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWRtaW4td29yZHdyYXBfY3J1ZCcpO1xyXG5cclxuICAgIGlmICh0eXBlb2YgcHJvZHVjdHNMaXN0ICE9ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgICAgbmV3IFByb2R1Y3RzTGlzdChwcm9kdWN0c0xpc3QpO1xyXG4gICAgfVxyXG59KTsiLCIvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuICogIGpxdWVyeS1zb3J0YWJsZS5qcyB2MC45LjEzXHJcbiAqICBodHRwOi8vam9obm55LmdpdGh1Yi5jb20vanF1ZXJ5LXNvcnRhYmxlL1xyXG4gKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuICogIENvcHlyaWdodCAoYykgMjAxMiBKb25hcyB2b24gQW5kcmlhblxyXG4gKiAgQWxsIHJpZ2h0cyByZXNlcnZlZC5cclxuICpcclxuICogIFJlZGlzdHJpYnV0aW9uIGFuZCB1c2UgaW4gc291cmNlIGFuZCBiaW5hcnkgZm9ybXMsIHdpdGggb3Igd2l0aG91dFxyXG4gKiAgbW9kaWZpY2F0aW9uLCBhcmUgcGVybWl0dGVkIHByb3ZpZGVkIHRoYXQgdGhlIGZvbGxvd2luZyBjb25kaXRpb25zIGFyZSBtZXQ6XHJcbiAqICAqIFJlZGlzdHJpYnV0aW9ucyBvZiBzb3VyY2UgY29kZSBtdXN0IHJldGFpbiB0aGUgYWJvdmUgY29weXJpZ2h0XHJcbiAqICAgIG5vdGljZSwgdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lci5cclxuICogICogUmVkaXN0cmlidXRpb25zIGluIGJpbmFyeSBmb3JtIG11c3QgcmVwcm9kdWNlIHRoZSBhYm92ZSBjb3B5cmlnaHRcclxuICogICAgbm90aWNlLCB0aGlzIGxpc3Qgb2YgY29uZGl0aW9ucyBhbmQgdGhlIGZvbGxvd2luZyBkaXNjbGFpbWVyIGluIHRoZVxyXG4gKiAgICBkb2N1bWVudGF0aW9uIGFuZC9vciBvdGhlciBtYXRlcmlhbHMgcHJvdmlkZWQgd2l0aCB0aGUgZGlzdHJpYnV0aW9uLlxyXG4gKiAgKiBUaGUgbmFtZSBvZiB0aGUgYXV0aG9yIG1heSBub3QgYmUgdXNlZCB0byBlbmRvcnNlIG9yIHByb21vdGUgcHJvZHVjdHNcclxuICogICAgZGVyaXZlZCBmcm9tIHRoaXMgc29mdHdhcmUgd2l0aG91dCBzcGVjaWZpYyBwcmlvciB3cml0dGVuIHBlcm1pc3Npb24uXHJcbiAqXHJcbiAqICBUSElTIFNPRlRXQVJFIElTIFBST1ZJREVEIEJZIFRIRSBDT1BZUklHSFQgSE9MREVSUyBBTkQgQ09OVFJJQlVUT1JTIFwiQVMgSVNcIiBBTkRcclxuICogIEFOWSBFWFBSRVNTIE9SIElNUExJRUQgV0FSUkFOVElFUywgSU5DTFVESU5HLCBCVVQgTk9UIExJTUlURUQgVE8sIFRIRSBJTVBMSUVEXHJcbiAqICBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSBBTkQgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQVJFXHJcbiAqICBESVNDTEFJTUVELiBJTiBOTyBFVkVOVCBTSEFMTCA8Q09QWVJJR0hUIEhPTERFUj4gQkUgTElBQkxFIEZPUiBBTllcclxuICogIERJUkVDVCwgSU5ESVJFQ1QsIElOQ0lERU5UQUwsIFNQRUNJQUwsIEVYRU1QTEFSWSwgT1IgQ09OU0VRVUVOVElBTCBEQU1BR0VTXHJcbiAqICAoSU5DTFVESU5HLCBCVVQgTk9UIExJTUlURUQgVE8sIFBST0NVUkVNRU5UIE9GIFNVQlNUSVRVVEUgR09PRFMgT1IgU0VSVklDRVM7XHJcbiAqICBMT1NTIE9GIFVTRSwgREFUQSwgT1IgUFJPRklUUzsgT1IgQlVTSU5FU1MgSU5URVJSVVBUSU9OKSBIT1dFVkVSIENBVVNFRCBBTkRcclxuICogIE9OIEFOWSBUSEVPUlkgT0YgTElBQklMSVRZLCBXSEVUSEVSIElOIENPTlRSQUNULCBTVFJJQ1QgTElBQklMSVRZLCBPUiBUT1JUXHJcbiAqICAoSU5DTFVESU5HIE5FR0xJR0VOQ0UgT1IgT1RIRVJXSVNFKSBBUklTSU5HIElOIEFOWSBXQVkgT1VUIE9GIFRIRSBVU0UgT0YgVEhJU1xyXG4gKiAgU09GVFdBUkUsIEVWRU4gSUYgQURWSVNFRCBPRiBUSEUgUE9TU0lCSUxJVFkgT0YgU1VDSCBEQU1BR0UuXHJcbiAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cclxuXHJcbiFmdW5jdGlvbiAoICQsIHdpbmRvdywgcGx1Z2luTmFtZSwgdW5kZWZpbmVkKXtcclxuICB2YXIgY29udGFpbmVyRGVmYXVsdHMgPSB7XHJcbiAgICAvLyBJZiB0cnVlLCBpdGVtcyBjYW4gYmUgZHJhZ2dlZCBmcm9tIHRoaXMgY29udGFpbmVyXHJcbiAgICBkcmFnOiB0cnVlLFxyXG4gICAgLy8gSWYgdHJ1ZSwgaXRlbXMgY2FuIGJlIGRyb3BlZCBvbnRvIHRoaXMgY29udGFpbmVyXHJcbiAgICBkcm9wOiB0cnVlLFxyXG4gICAgLy8gRXhjbHVkZSBpdGVtcyBmcm9tIGJlaW5nIGRyYWdnYWJsZSwgaWYgdGhlXHJcbiAgICAvLyBzZWxlY3RvciBtYXRjaGVzIHRoZSBpdGVtXHJcbiAgICBleGNsdWRlOiBcIlwiLFxyXG4gICAgLy8gSWYgdHJ1ZSwgc2VhcmNoIGZvciBuZXN0ZWQgY29udGFpbmVycyB3aXRoaW4gYW4gaXRlbS5JZiB5b3UgbmVzdCBjb250YWluZXJzLFxyXG4gICAgLy8gZWl0aGVyIHRoZSBvcmlnaW5hbCBzZWxlY3RvciB3aXRoIHdoaWNoIHlvdSBjYWxsIHRoZSBwbHVnaW4gbXVzdCBvbmx5IG1hdGNoIHRoZSB0b3AgY29udGFpbmVycyxcclxuICAgIC8vIG9yIHlvdSBuZWVkIHRvIHNwZWNpZnkgYSBncm91cCAoc2VlIHRoZSBib290c3RyYXAgbmF2IGV4YW1wbGUpXHJcbiAgICBuZXN0ZWQ6IHRydWUsXHJcbiAgICAvLyBJZiB0cnVlLCB0aGUgaXRlbXMgYXJlIGFzc3VtZWQgdG8gYmUgYXJyYW5nZWQgdmVydGljYWxseVxyXG4gICAgdmVydGljYWw6IHRydWVcclxuICB9LCAvLyBlbmQgY29udGFpbmVyIGRlZmF1bHRzXHJcbiAgZ3JvdXBEZWZhdWx0cyA9IHtcclxuICAgIC8vIFRoaXMgaXMgZXhlY3V0ZWQgYWZ0ZXIgdGhlIHBsYWNlaG9sZGVyIGhhcyBiZWVuIG1vdmVkLlxyXG4gICAgLy8gJGNsb3Nlc3RJdGVtT3JDb250YWluZXIgY29udGFpbnMgdGhlIGNsb3Nlc3QgaXRlbSwgdGhlIHBsYWNlaG9sZGVyXHJcbiAgICAvLyBoYXMgYmVlbiBwdXQgYXQgb3IgdGhlIGNsb3Nlc3QgZW1wdHkgQ29udGFpbmVyLCB0aGUgcGxhY2Vob2xkZXIgaGFzXHJcbiAgICAvLyBiZWVuIGFwcGVuZGVkIHRvLlxyXG4gICAgYWZ0ZXJNb3ZlOiBmdW5jdGlvbiAoJHBsYWNlaG9sZGVyLCBjb250YWluZXIsICRjbG9zZXN0SXRlbU9yQ29udGFpbmVyKSB7XHJcbiAgICB9LFxyXG4gICAgLy8gVGhlIGV4YWN0IGNzcyBwYXRoIGJldHdlZW4gdGhlIGNvbnRhaW5lciBhbmQgaXRzIGl0ZW1zLCBlLmcuIFwiPiB0Ym9keVwiXHJcbiAgICBjb250YWluZXJQYXRoOiBcIlwiLFxyXG4gICAgLy8gVGhlIGNzcyBzZWxlY3RvciBvZiB0aGUgY29udGFpbmVyc1xyXG4gICAgY29udGFpbmVyU2VsZWN0b3I6IFwib2wsIHVsXCIsXHJcbiAgICAvLyBEaXN0YW5jZSB0aGUgbW91c2UgaGFzIHRvIHRyYXZlbCB0byBzdGFydCBkcmFnZ2luZ1xyXG4gICAgZGlzdGFuY2U6IDAsXHJcbiAgICAvLyBUaW1lIGluIG1pbGxpc2Vjb25kcyBhZnRlciBtb3VzZWRvd24gdW50aWwgZHJhZ2dpbmcgc2hvdWxkIHN0YXJ0LlxyXG4gICAgLy8gVGhpcyBvcHRpb24gY2FuIGJlIHVzZWQgdG8gcHJldmVudCB1bndhbnRlZCBkcmFncyB3aGVuIGNsaWNraW5nIG9uIGFuIGVsZW1lbnQuXHJcbiAgICBkZWxheTogMCxcclxuICAgIC8vIFRoZSBjc3Mgc2VsZWN0b3Igb2YgdGhlIGRyYWcgaGFuZGxlXHJcbiAgICBoYW5kbGU6IFwiXCIsXHJcbiAgICAvLyBUaGUgZXhhY3QgY3NzIHBhdGggYmV0d2VlbiB0aGUgaXRlbSBhbmQgaXRzIHN1YmNvbnRhaW5lcnMuXHJcbiAgICAvLyBJdCBzaG91bGQgb25seSBtYXRjaCB0aGUgaW1tZWRpYXRlIGl0ZW1zIG9mIGEgY29udGFpbmVyLlxyXG4gICAgLy8gTm8gaXRlbSBvZiBhIHN1YmNvbnRhaW5lciBzaG91bGQgYmUgbWF0Y2hlZC4gRS5nLiBmb3Igb2w+ZGl2PmxpIHRoZSBpdGVtUGF0aCBpcyBcIj4gZGl2XCJcclxuICAgIGl0ZW1QYXRoOiBcIlwiLFxyXG4gICAgLy8gVGhlIGNzcyBzZWxlY3RvciBvZiB0aGUgaXRlbXNcclxuICAgIGl0ZW1TZWxlY3RvcjogXCJsaVwiLFxyXG4gICAgLy8gVGhlIGNsYXNzIGdpdmVuIHRvIFwiYm9keVwiIHdoaWxlIGFuIGl0ZW0gaXMgYmVpbmcgZHJhZ2dlZFxyXG4gICAgYm9keUNsYXNzOiBcImRyYWdnaW5nXCIsXHJcbiAgICAvLyBUaGUgY2xhc3MgZ2l2aW5nIHRvIGFuIGl0ZW0gd2hpbGUgYmVpbmcgZHJhZ2dlZFxyXG4gICAgZHJhZ2dlZENsYXNzOiBcImRyYWdnZWRcIixcclxuICAgIC8vIENoZWNrIGlmIHRoZSBkcmFnZ2VkIGl0ZW0gbWF5IGJlIGluc2lkZSB0aGUgY29udGFpbmVyLlxyXG4gICAgLy8gVXNlIHdpdGggY2FyZSwgc2luY2UgdGhlIHNlYXJjaCBmb3IgYSB2YWxpZCBjb250YWluZXIgZW50YWlscyBhIGRlcHRoIGZpcnN0IHNlYXJjaFxyXG4gICAgLy8gYW5kIG1heSBiZSBxdWl0ZSBleHBlbnNpdmUuXHJcbiAgICBpc1ZhbGlkVGFyZ2V0OiBmdW5jdGlvbiAoJGl0ZW0sIGNvbnRhaW5lcikge1xyXG4gICAgICByZXR1cm4gdHJ1ZVxyXG4gICAgfSxcclxuICAgIC8vIEV4ZWN1dGVkIGJlZm9yZSBvbkRyb3AgaWYgcGxhY2Vob2xkZXIgaXMgZGV0YWNoZWQuXHJcbiAgICAvLyBUaGlzIGhhcHBlbnMgaWYgcHVsbFBsYWNlaG9sZGVyIGlzIHNldCB0byBmYWxzZSBhbmQgdGhlIGRyb3Agb2NjdXJzIG91dHNpZGUgYSBjb250YWluZXIuXHJcbiAgICBvbkNhbmNlbDogZnVuY3Rpb24gKCRpdGVtLCBjb250YWluZXIsIF9zdXBlciwgZXZlbnQpIHtcclxuICAgIH0sXHJcbiAgICAvLyBFeGVjdXRlZCBhdCB0aGUgYmVnaW5uaW5nIG9mIGEgbW91c2UgbW92ZSBldmVudC5cclxuICAgIC8vIFRoZSBQbGFjZWhvbGRlciBoYXMgbm90IGJlZW4gbW92ZWQgeWV0LlxyXG4gICAgb25EcmFnOiBmdW5jdGlvbiAoJGl0ZW0sIHBvc2l0aW9uLCBfc3VwZXIsIGV2ZW50KSB7XHJcbiAgICAgICRpdGVtLmNzcyhwb3NpdGlvbilcclxuICAgIH0sXHJcbiAgICAvLyBDYWxsZWQgYWZ0ZXIgdGhlIGRyYWcgaGFzIGJlZW4gc3RhcnRlZCxcclxuICAgIC8vIHRoYXQgaXMgdGhlIG1vdXNlIGJ1dHRvbiBpcyBiZWluZyBoZWxkIGRvd24gYW5kXHJcbiAgICAvLyB0aGUgbW91c2UgaXMgbW92aW5nLlxyXG4gICAgLy8gVGhlIGNvbnRhaW5lciBpcyB0aGUgY2xvc2VzdCBpbml0aWFsaXplZCBjb250YWluZXIuXHJcbiAgICAvLyBUaGVyZWZvcmUgaXQgbWlnaHQgbm90IGJlIHRoZSBjb250YWluZXIsIHRoYXQgYWN0dWFsbHkgY29udGFpbnMgdGhlIGl0ZW0uXHJcbiAgICBvbkRyYWdTdGFydDogZnVuY3Rpb24gKCRpdGVtLCBjb250YWluZXIsIF9zdXBlciwgZXZlbnQpIHtcclxuICAgICAgJGl0ZW0uY3NzKHtcclxuICAgICAgICBoZWlnaHQ6ICRpdGVtLm91dGVySGVpZ2h0KCksXHJcbiAgICAgICAgd2lkdGg6ICRpdGVtLm91dGVyV2lkdGgoKVxyXG4gICAgICB9KVxyXG4gICAgICAkaXRlbS5hZGRDbGFzcyhjb250YWluZXIuZ3JvdXAub3B0aW9ucy5kcmFnZ2VkQ2xhc3MpXHJcbiAgICAgICQoXCJib2R5XCIpLmFkZENsYXNzKGNvbnRhaW5lci5ncm91cC5vcHRpb25zLmJvZHlDbGFzcylcclxuICAgIH0sXHJcbiAgICAvLyBDYWxsZWQgd2hlbiB0aGUgbW91c2UgYnV0dG9uIGlzIGJlaW5nIHJlbGVhc2VkXHJcbiAgICBvbkRyb3A6IGZ1bmN0aW9uICgkaXRlbSwgY29udGFpbmVyLCBfc3VwZXIsIGV2ZW50KSB7XHJcbiAgICAgICRpdGVtLnJlbW92ZUNsYXNzKGNvbnRhaW5lci5ncm91cC5vcHRpb25zLmRyYWdnZWRDbGFzcykucmVtb3ZlQXR0cihcInN0eWxlXCIpXHJcbiAgICAgICQoXCJib2R5XCIpLnJlbW92ZUNsYXNzKGNvbnRhaW5lci5ncm91cC5vcHRpb25zLmJvZHlDbGFzcylcclxuICAgIH0sXHJcbiAgICAvLyBDYWxsZWQgb24gbW91c2Vkb3duLiBJZiBmYWxzeSB2YWx1ZSBpcyByZXR1cm5lZCwgdGhlIGRyYWdnaW5nIHdpbGwgbm90IHN0YXJ0LlxyXG4gICAgLy8gSWdub3JlIGlmIGVsZW1lbnQgY2xpY2tlZCBpcyBpbnB1dCwgc2VsZWN0IG9yIHRleHRhcmVhXHJcbiAgICBvbk1vdXNlZG93bjogZnVuY3Rpb24gKCRpdGVtLCBfc3VwZXIsIGV2ZW50KSB7XHJcbiAgICAgIGlmICghZXZlbnQudGFyZ2V0Lm5vZGVOYW1lLm1hdGNoKC9eKGlucHV0fHNlbGVjdHx0ZXh0YXJlYSkkL2kpKSB7XHJcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKVxyXG4gICAgICAgIHJldHVybiB0cnVlXHJcbiAgICAgIH1cclxuICAgIH0sXHJcbiAgICAvLyBUaGUgY2xhc3Mgb2YgdGhlIHBsYWNlaG9sZGVyIChtdXN0IG1hdGNoIHBsYWNlaG9sZGVyIG9wdGlvbiBtYXJrdXApXHJcbiAgICBwbGFjZWhvbGRlckNsYXNzOiBcInBsYWNlaG9sZGVyXCIsXHJcbiAgICAvLyBUZW1wbGF0ZSBmb3IgdGhlIHBsYWNlaG9sZGVyLiBDYW4gYmUgYW55IHZhbGlkIGpRdWVyeSBpbnB1dFxyXG4gICAgLy8gZS5nLiBhIHN0cmluZywgYSBET00gZWxlbWVudC5cclxuICAgIC8vIFRoZSBwbGFjZWhvbGRlciBtdXN0IGhhdmUgdGhlIGNsYXNzIFwicGxhY2Vob2xkZXJcIlxyXG4gICAgcGxhY2Vob2xkZXI6ICc8bGkgY2xhc3M9XCJwbGFjZWhvbGRlclwiPjwvbGk+JyxcclxuICAgIC8vIElmIHRydWUsIHRoZSBwb3NpdGlvbiBvZiB0aGUgcGxhY2Vob2xkZXIgaXMgY2FsY3VsYXRlZCBvbiBldmVyeSBtb3VzZW1vdmUuXHJcbiAgICAvLyBJZiBmYWxzZSwgaXQgaXMgb25seSBjYWxjdWxhdGVkIHdoZW4gdGhlIG1vdXNlIGlzIGFib3ZlIGEgY29udGFpbmVyLlxyXG4gICAgcHVsbFBsYWNlaG9sZGVyOiB0cnVlLFxyXG4gICAgLy8gU3BlY2lmaWVzIHNlcmlhbGl6YXRpb24gb2YgdGhlIGNvbnRhaW5lciBncm91cC5cclxuICAgIC8vIFRoZSBwYWlyICRwYXJlbnQvJGNoaWxkcmVuIGlzIGVpdGhlciBjb250YWluZXIvaXRlbXMgb3IgaXRlbS9zdWJjb250YWluZXJzLlxyXG4gICAgc2VyaWFsaXplOiBmdW5jdGlvbiAoJHBhcmVudCwgJGNoaWxkcmVuLCBwYXJlbnRJc0NvbnRhaW5lcikge1xyXG4gICAgICB2YXIgcmVzdWx0ID0gJC5leHRlbmQoe30sICRwYXJlbnQuZGF0YSgpKVxyXG5cclxuICAgICAgaWYocGFyZW50SXNDb250YWluZXIpXHJcbiAgICAgICAgcmV0dXJuIFskY2hpbGRyZW5dXHJcbiAgICAgIGVsc2UgaWYgKCRjaGlsZHJlblswXSl7XHJcbiAgICAgICAgcmVzdWx0LmNoaWxkcmVuID0gJGNoaWxkcmVuXHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGRlbGV0ZSByZXN1bHQuc3ViQ29udGFpbmVyc1xyXG4gICAgICBkZWxldGUgcmVzdWx0LnNvcnRhYmxlXHJcblxyXG4gICAgICByZXR1cm4gcmVzdWx0XHJcbiAgICB9LFxyXG4gICAgLy8gU2V0IHRvbGVyYW5jZSB3aGlsZSBkcmFnZ2luZy4gUG9zaXRpdmUgdmFsdWVzIGRlY3JlYXNlIHNlbnNpdGl2aXR5LFxyXG4gICAgLy8gbmVnYXRpdmUgdmFsdWVzIGluY3JlYXNlIGl0LlxyXG4gICAgdG9sZXJhbmNlOiAwXHJcbiAgfSwgLy8gZW5kIGdyb3VwIGRlZmF1bHRzXHJcbiAgY29udGFpbmVyR3JvdXBzID0ge30sXHJcbiAgZ3JvdXBDb3VudGVyID0gMCxcclxuICBlbXB0eUJveCA9IHtcclxuICAgIGxlZnQ6IDAsXHJcbiAgICB0b3A6IDAsXHJcbiAgICBib3R0b206IDAsXHJcbiAgICByaWdodDowXHJcbiAgfSxcclxuICBldmVudE5hbWVzID0ge1xyXG4gICAgc3RhcnQ6IFwidG91Y2hzdGFydC5zb3J0YWJsZSBtb3VzZWRvd24uc29ydGFibGVcIixcclxuICAgIGRyb3A6IFwidG91Y2hlbmQuc29ydGFibGUgdG91Y2hjYW5jZWwuc29ydGFibGUgbW91c2V1cC5zb3J0YWJsZVwiLFxyXG4gICAgZHJhZzogXCJ0b3VjaG1vdmUuc29ydGFibGUgbW91c2Vtb3ZlLnNvcnRhYmxlXCIsXHJcbiAgICBzY3JvbGw6IFwic2Nyb2xsLnNvcnRhYmxlXCJcclxuICB9LFxyXG4gIHN1YkNvbnRhaW5lcktleSA9IFwic3ViQ29udGFpbmVyc1wiXHJcblxyXG4gIC8qXHJcbiAgICogYSBpcyBBcnJheSBbbGVmdCwgcmlnaHQsIHRvcCwgYm90dG9tXVxyXG4gICAqIGIgaXMgYXJyYXkgW2xlZnQsIHRvcF1cclxuICAgKi9cclxuICBmdW5jdGlvbiBkKGEsYikge1xyXG4gICAgdmFyIHggPSBNYXRoLm1heCgwLCBhWzBdIC0gYlswXSwgYlswXSAtIGFbMV0pLFxyXG4gICAgeSA9IE1hdGgubWF4KDAsIGFbMl0gLSBiWzFdLCBiWzFdIC0gYVszXSlcclxuICAgIHJldHVybiB4K3k7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBzZXREaW1lbnNpb25zKGFycmF5LCBkaW1lbnNpb25zLCB0b2xlcmFuY2UsIHVzZU9mZnNldCkge1xyXG4gICAgdmFyIGkgPSBhcnJheS5sZW5ndGgsXHJcbiAgICBvZmZzZXRNZXRob2QgPSB1c2VPZmZzZXQgPyBcIm9mZnNldFwiIDogXCJwb3NpdGlvblwiXHJcbiAgICB0b2xlcmFuY2UgPSB0b2xlcmFuY2UgfHwgMFxyXG5cclxuICAgIHdoaWxlKGktLSl7XHJcbiAgICAgIHZhciBlbCA9IGFycmF5W2ldLmVsID8gYXJyYXlbaV0uZWwgOiAkKGFycmF5W2ldKSxcclxuICAgICAgLy8gdXNlIGZpdHRpbmcgbWV0aG9kXHJcbiAgICAgIHBvcyA9IGVsW29mZnNldE1ldGhvZF0oKVxyXG4gICAgICBwb3MubGVmdCArPSBwYXJzZUludChlbC5jc3MoJ21hcmdpbi1sZWZ0JyksIDEwKVxyXG4gICAgICBwb3MudG9wICs9IHBhcnNlSW50KGVsLmNzcygnbWFyZ2luLXRvcCcpLDEwKVxyXG4gICAgICBkaW1lbnNpb25zW2ldID0gW1xyXG4gICAgICAgIHBvcy5sZWZ0IC0gdG9sZXJhbmNlLFxyXG4gICAgICAgIHBvcy5sZWZ0ICsgZWwub3V0ZXJXaWR0aCgpICsgdG9sZXJhbmNlLFxyXG4gICAgICAgIHBvcy50b3AgLSB0b2xlcmFuY2UsXHJcbiAgICAgICAgcG9zLnRvcCArIGVsLm91dGVySGVpZ2h0KCkgKyB0b2xlcmFuY2VcclxuICAgICAgXVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gZ2V0UmVsYXRpdmVQb3NpdGlvbihwb2ludGVyLCBlbGVtZW50KSB7XHJcbiAgICB2YXIgb2Zmc2V0ID0gZWxlbWVudC5vZmZzZXQoKVxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgbGVmdDogcG9pbnRlci5sZWZ0IC0gb2Zmc2V0LmxlZnQsXHJcbiAgICAgIHRvcDogcG9pbnRlci50b3AgLSBvZmZzZXQudG9wXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBzb3J0QnlEaXN0YW5jZURlc2MoZGltZW5zaW9ucywgcG9pbnRlciwgbGFzdFBvaW50ZXIpIHtcclxuICAgIHBvaW50ZXIgPSBbcG9pbnRlci5sZWZ0LCBwb2ludGVyLnRvcF1cclxuICAgIGxhc3RQb2ludGVyID0gbGFzdFBvaW50ZXIgJiYgW2xhc3RQb2ludGVyLmxlZnQsIGxhc3RQb2ludGVyLnRvcF1cclxuXHJcbiAgICB2YXIgZGltLFxyXG4gICAgaSA9IGRpbWVuc2lvbnMubGVuZ3RoLFxyXG4gICAgZGlzdGFuY2VzID0gW11cclxuXHJcbiAgICB3aGlsZShpLS0pe1xyXG4gICAgICBkaW0gPSBkaW1lbnNpb25zW2ldXHJcbiAgICAgIGRpc3RhbmNlc1tpXSA9IFtpLGQoZGltLHBvaW50ZXIpLCBsYXN0UG9pbnRlciAmJiBkKGRpbSwgbGFzdFBvaW50ZXIpXVxyXG4gICAgfVxyXG4gICAgZGlzdGFuY2VzID0gZGlzdGFuY2VzLnNvcnQoZnVuY3Rpb24gIChhLGIpIHtcclxuICAgICAgcmV0dXJuIGJbMV0gLSBhWzFdIHx8IGJbMl0gLSBhWzJdIHx8IGJbMF0gLSBhWzBdXHJcbiAgICB9KVxyXG5cclxuICAgIC8vIGxhc3QgZW50cnkgaXMgdGhlIGNsb3Nlc3RcclxuICAgIHJldHVybiBkaXN0YW5jZXNcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIENvbnRhaW5lckdyb3VwKG9wdGlvbnMpIHtcclxuICAgIHRoaXMub3B0aW9ucyA9ICQuZXh0ZW5kKHt9LCBncm91cERlZmF1bHRzLCBvcHRpb25zKVxyXG4gICAgdGhpcy5jb250YWluZXJzID0gW11cclxuXHJcbiAgICBpZighdGhpcy5vcHRpb25zLnJvb3RHcm91cCl7XHJcbiAgICAgIHRoaXMuc2Nyb2xsUHJveHkgPSAkLnByb3h5KHRoaXMuc2Nyb2xsLCB0aGlzKVxyXG4gICAgICB0aGlzLmRyYWdQcm94eSA9ICQucHJveHkodGhpcy5kcmFnLCB0aGlzKVxyXG4gICAgICB0aGlzLmRyb3BQcm94eSA9ICQucHJveHkodGhpcy5kcm9wLCB0aGlzKVxyXG4gICAgICB0aGlzLnBsYWNlaG9sZGVyID0gJCh0aGlzLm9wdGlvbnMucGxhY2Vob2xkZXIpXHJcblxyXG4gICAgICBpZighb3B0aW9ucy5pc1ZhbGlkVGFyZ2V0KVxyXG4gICAgICAgIHRoaXMub3B0aW9ucy5pc1ZhbGlkVGFyZ2V0ID0gdW5kZWZpbmVkXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBDb250YWluZXJHcm91cC5nZXQgPSBmdW5jdGlvbiAgKG9wdGlvbnMpIHtcclxuICAgIGlmKCFjb250YWluZXJHcm91cHNbb3B0aW9ucy5ncm91cF0pIHtcclxuICAgICAgaWYob3B0aW9ucy5ncm91cCA9PT0gdW5kZWZpbmVkKVxyXG4gICAgICAgIG9wdGlvbnMuZ3JvdXAgPSBncm91cENvdW50ZXIgKytcclxuXHJcbiAgICAgIGNvbnRhaW5lckdyb3Vwc1tvcHRpb25zLmdyb3VwXSA9IG5ldyBDb250YWluZXJHcm91cChvcHRpb25zKVxyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBjb250YWluZXJHcm91cHNbb3B0aW9ucy5ncm91cF1cclxuICB9XHJcblxyXG4gIENvbnRhaW5lckdyb3VwLnByb3RvdHlwZSA9IHtcclxuICAgIGRyYWdJbml0OiBmdW5jdGlvbiAgKGUsIGl0ZW1Db250YWluZXIpIHtcclxuICAgICAgdGhpcy4kZG9jdW1lbnQgPSAkKGl0ZW1Db250YWluZXIuZWxbMF0ub3duZXJEb2N1bWVudClcclxuXHJcbiAgICAgIC8vIGdldCBpdGVtIHRvIGRyYWdcclxuICAgICAgdmFyIGNsb3Nlc3RJdGVtID0gJChlLnRhcmdldCkuY2xvc2VzdCh0aGlzLm9wdGlvbnMuaXRlbVNlbGVjdG9yKTtcclxuICAgICAgLy8gdXNpbmcgdGhlIGxlbmd0aCBvZiB0aGlzIGl0ZW0sIHByZXZlbnRzIHRoZSBwbHVnaW4gZnJvbSBiZWluZyBzdGFydGVkIGlmIHRoZXJlIGlzIG5vIGhhbmRsZSBiZWluZyBjbGlja2VkIG9uLlxyXG4gICAgICAvLyB0aGlzIG1heSBhbHNvIGJlIGhlbHBmdWwgaW4gaW5zdGFudGlhdGluZyBtdWx0aWRyYWcuXHJcbiAgICAgIGlmIChjbG9zZXN0SXRlbS5sZW5ndGgpIHtcclxuICAgICAgICB0aGlzLml0ZW0gPSBjbG9zZXN0SXRlbTtcclxuICAgICAgICB0aGlzLml0ZW1Db250YWluZXIgPSBpdGVtQ29udGFpbmVyO1xyXG4gICAgICAgIGlmICh0aGlzLml0ZW0uaXModGhpcy5vcHRpb25zLmV4Y2x1ZGUpIHx8ICF0aGlzLm9wdGlvbnMub25Nb3VzZWRvd24odGhpcy5pdGVtLCBncm91cERlZmF1bHRzLm9uTW91c2Vkb3duLCBlKSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuc2V0UG9pbnRlcihlKTtcclxuICAgICAgICB0aGlzLnRvZ2dsZUxpc3RlbmVycygnb24nKTtcclxuICAgICAgICB0aGlzLnNldHVwRGVsYXlUaW1lcigpO1xyXG4gICAgICAgIHRoaXMuZHJhZ0luaXREb25lID0gdHJ1ZTtcclxuICAgICAgfVxyXG4gICAgfSxcclxuICAgIGRyYWc6IGZ1bmN0aW9uICAoZSkge1xyXG4gICAgICBpZighdGhpcy5kcmFnZ2luZyl7XHJcbiAgICAgICAgaWYoIXRoaXMuZGlzdGFuY2VNZXQoZSkgfHwgIXRoaXMuZGVsYXlNZXQpXHJcbiAgICAgICAgICByZXR1cm5cclxuXHJcbiAgICAgICAgdGhpcy5vcHRpb25zLm9uRHJhZ1N0YXJ0KHRoaXMuaXRlbSwgdGhpcy5pdGVtQ29udGFpbmVyLCBncm91cERlZmF1bHRzLm9uRHJhZ1N0YXJ0LCBlKVxyXG4gICAgICAgIHRoaXMuaXRlbS5iZWZvcmUodGhpcy5wbGFjZWhvbGRlcilcclxuICAgICAgICB0aGlzLmRyYWdnaW5nID0gdHJ1ZVxyXG4gICAgICB9XHJcblxyXG4gICAgICB0aGlzLnNldFBvaW50ZXIoZSlcclxuICAgICAgLy8gcGxhY2UgaXRlbSB1bmRlciB0aGUgY3Vyc29yXHJcbiAgICAgIHRoaXMub3B0aW9ucy5vbkRyYWcodGhpcy5pdGVtLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGdldFJlbGF0aXZlUG9zaXRpb24odGhpcy5wb2ludGVyLCB0aGlzLml0ZW0ub2Zmc2V0UGFyZW50KCkpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGdyb3VwRGVmYXVsdHMub25EcmFnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGUpXHJcblxyXG4gICAgICB2YXIgcCA9IHRoaXMuZ2V0UG9pbnRlcihlKSxcclxuICAgICAgYm94ID0gdGhpcy5zYW1lUmVzdWx0Qm94LFxyXG4gICAgICB0ID0gdGhpcy5vcHRpb25zLnRvbGVyYW5jZVxyXG5cclxuICAgICAgaWYoIWJveCB8fCBib3gudG9wIC0gdCA+IHAudG9wIHx8IGJveC5ib3R0b20gKyB0IDwgcC50b3AgfHwgYm94LmxlZnQgLSB0ID4gcC5sZWZ0IHx8IGJveC5yaWdodCArIHQgPCBwLmxlZnQpXHJcbiAgICAgICAgaWYoIXRoaXMuc2VhcmNoVmFsaWRUYXJnZXQoKSl7XHJcbiAgICAgICAgICB0aGlzLnBsYWNlaG9sZGVyLmRldGFjaCgpXHJcbiAgICAgICAgICB0aGlzLmxhc3RBcHBlbmRlZEl0ZW0gPSB1bmRlZmluZWRcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG4gICAgZHJvcDogZnVuY3Rpb24gIChlKSB7XHJcbiAgICAgIHRoaXMudG9nZ2xlTGlzdGVuZXJzKCdvZmYnKVxyXG5cclxuICAgICAgdGhpcy5kcmFnSW5pdERvbmUgPSBmYWxzZVxyXG5cclxuICAgICAgaWYodGhpcy5kcmFnZ2luZyl7XHJcbiAgICAgICAgLy8gcHJvY2Vzc2luZyBEcm9wLCBjaGVjayBpZiBwbGFjZWhvbGRlciBpcyBkZXRhY2hlZFxyXG4gICAgICAgIGlmKHRoaXMucGxhY2Vob2xkZXIuY2xvc2VzdChcImh0bWxcIilbMF0pe1xyXG4gICAgICAgICAgdGhpcy5wbGFjZWhvbGRlci5iZWZvcmUodGhpcy5pdGVtKS5kZXRhY2goKVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICB0aGlzLm9wdGlvbnMub25DYW5jZWwodGhpcy5pdGVtLCB0aGlzLml0ZW1Db250YWluZXIsIGdyb3VwRGVmYXVsdHMub25DYW5jZWwsIGUpXHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMub3B0aW9ucy5vbkRyb3AodGhpcy5pdGVtLCB0aGlzLmdldENvbnRhaW5lcih0aGlzLml0ZW0pLCBncm91cERlZmF1bHRzLm9uRHJvcCwgZSlcclxuXHJcbiAgICAgICAgLy8gY2xlYW51cFxyXG4gICAgICAgIHRoaXMuY2xlYXJEaW1lbnNpb25zKClcclxuICAgICAgICB0aGlzLmNsZWFyT2Zmc2V0UGFyZW50KClcclxuICAgICAgICB0aGlzLmxhc3RBcHBlbmRlZEl0ZW0gPSB0aGlzLnNhbWVSZXN1bHRCb3ggPSB1bmRlZmluZWRcclxuICAgICAgICB0aGlzLmRyYWdnaW5nID0gZmFsc2VcclxuICAgICAgfVxyXG4gICAgfSxcclxuICAgIHNlYXJjaFZhbGlkVGFyZ2V0OiBmdW5jdGlvbiAgKHBvaW50ZXIsIGxhc3RQb2ludGVyKSB7XHJcbiAgICAgIGlmKCFwb2ludGVyKXtcclxuICAgICAgICBwb2ludGVyID0gdGhpcy5yZWxhdGl2ZVBvaW50ZXIgfHwgdGhpcy5wb2ludGVyXHJcbiAgICAgICAgbGFzdFBvaW50ZXIgPSB0aGlzLmxhc3RSZWxhdGl2ZVBvaW50ZXIgfHwgdGhpcy5sYXN0UG9pbnRlclxyXG4gICAgICB9XHJcblxyXG4gICAgICB2YXIgZGlzdGFuY2VzID0gc29ydEJ5RGlzdGFuY2VEZXNjKHRoaXMuZ2V0Q29udGFpbmVyRGltZW5zaW9ucygpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50ZXIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFzdFBvaW50ZXIpLFxyXG4gICAgICBpID0gZGlzdGFuY2VzLmxlbmd0aFxyXG5cclxuICAgICAgd2hpbGUoaS0tKXtcclxuICAgICAgICB2YXIgaW5kZXggPSBkaXN0YW5jZXNbaV1bMF0sXHJcbiAgICAgICAgZGlzdGFuY2UgPSBkaXN0YW5jZXNbaV1bMV1cclxuXHJcbiAgICAgICAgaWYoIWRpc3RhbmNlIHx8IHRoaXMub3B0aW9ucy5wdWxsUGxhY2Vob2xkZXIpe1xyXG4gICAgICAgICAgdmFyIGNvbnRhaW5lciA9IHRoaXMuY29udGFpbmVyc1tpbmRleF1cclxuICAgICAgICAgIGlmKCFjb250YWluZXIuZGlzYWJsZWQpe1xyXG4gICAgICAgICAgICBpZighdGhpcy4kZ2V0T2Zmc2V0UGFyZW50KCkpe1xyXG4gICAgICAgICAgICAgIHZhciBvZmZzZXRQYXJlbnQgPSBjb250YWluZXIuZ2V0SXRlbU9mZnNldFBhcmVudCgpXHJcbiAgICAgICAgICAgICAgcG9pbnRlciA9IGdldFJlbGF0aXZlUG9zaXRpb24ocG9pbnRlciwgb2Zmc2V0UGFyZW50KVxyXG4gICAgICAgICAgICAgIGxhc3RQb2ludGVyID0gZ2V0UmVsYXRpdmVQb3NpdGlvbihsYXN0UG9pbnRlciwgb2Zmc2V0UGFyZW50KVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmKGNvbnRhaW5lci5zZWFyY2hWYWxpZFRhcmdldChwb2ludGVyLCBsYXN0UG9pbnRlcikpXHJcbiAgICAgICAgICAgICAgcmV0dXJuIHRydWVcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgaWYodGhpcy5zYW1lUmVzdWx0Qm94KVxyXG4gICAgICAgIHRoaXMuc2FtZVJlc3VsdEJveCA9IHVuZGVmaW5lZFxyXG4gICAgfSxcclxuICAgIG1vdmVQbGFjZWhvbGRlcjogZnVuY3Rpb24gIChjb250YWluZXIsIGl0ZW0sIG1ldGhvZCwgc2FtZVJlc3VsdEJveCkge1xyXG4gICAgICB2YXIgbGFzdEFwcGVuZGVkSXRlbSA9IHRoaXMubGFzdEFwcGVuZGVkSXRlbVxyXG4gICAgICBpZighc2FtZVJlc3VsdEJveCAmJiBsYXN0QXBwZW5kZWRJdGVtICYmIGxhc3RBcHBlbmRlZEl0ZW1bMF0gPT09IGl0ZW1bMF0pXHJcbiAgICAgICAgcmV0dXJuO1xyXG5cclxuICAgICAgaXRlbVttZXRob2RdKHRoaXMucGxhY2Vob2xkZXIpXHJcbiAgICAgIHRoaXMubGFzdEFwcGVuZGVkSXRlbSA9IGl0ZW1cclxuICAgICAgdGhpcy5zYW1lUmVzdWx0Qm94ID0gc2FtZVJlc3VsdEJveFxyXG4gICAgICB0aGlzLm9wdGlvbnMuYWZ0ZXJNb3ZlKHRoaXMucGxhY2Vob2xkZXIsIGNvbnRhaW5lciwgaXRlbSlcclxuICAgIH0sXHJcbiAgICBnZXRDb250YWluZXJEaW1lbnNpb25zOiBmdW5jdGlvbiAgKCkge1xyXG4gICAgICBpZighdGhpcy5jb250YWluZXJEaW1lbnNpb25zKVxyXG4gICAgICAgIHNldERpbWVuc2lvbnModGhpcy5jb250YWluZXJzLCB0aGlzLmNvbnRhaW5lckRpbWVuc2lvbnMgPSBbXSwgdGhpcy5vcHRpb25zLnRvbGVyYW5jZSwgIXRoaXMuJGdldE9mZnNldFBhcmVudCgpKVxyXG4gICAgICByZXR1cm4gdGhpcy5jb250YWluZXJEaW1lbnNpb25zXHJcbiAgICB9LFxyXG4gICAgZ2V0Q29udGFpbmVyOiBmdW5jdGlvbiAgKGVsZW1lbnQpIHtcclxuICAgICAgcmV0dXJuIGVsZW1lbnQuY2xvc2VzdCh0aGlzLm9wdGlvbnMuY29udGFpbmVyU2VsZWN0b3IpLmRhdGEocGx1Z2luTmFtZSlcclxuICAgIH0sXHJcbiAgICAkZ2V0T2Zmc2V0UGFyZW50OiBmdW5jdGlvbiAgKCkge1xyXG4gICAgICBpZih0aGlzLm9mZnNldFBhcmVudCA9PT0gdW5kZWZpbmVkKXtcclxuICAgICAgICB2YXIgaSA9IHRoaXMuY29udGFpbmVycy5sZW5ndGggLSAxLFxyXG4gICAgICAgIG9mZnNldFBhcmVudCA9IHRoaXMuY29udGFpbmVyc1tpXS5nZXRJdGVtT2Zmc2V0UGFyZW50KClcclxuXHJcbiAgICAgICAgaWYoIXRoaXMub3B0aW9ucy5yb290R3JvdXApe1xyXG4gICAgICAgICAgd2hpbGUoaS0tKXtcclxuICAgICAgICAgICAgaWYob2Zmc2V0UGFyZW50WzBdICE9IHRoaXMuY29udGFpbmVyc1tpXS5nZXRJdGVtT2Zmc2V0UGFyZW50KClbMF0pe1xyXG4gICAgICAgICAgICAgIC8vIElmIGV2ZXJ5IGNvbnRhaW5lciBoYXMgdGhlIHNhbWUgb2Zmc2V0IHBhcmVudCxcclxuICAgICAgICAgICAgICAvLyB1c2UgcG9zaXRpb24oKSB3aGljaCBpcyByZWxhdGl2ZSB0byB0aGlzIHBhcmVudCxcclxuICAgICAgICAgICAgICAvLyBvdGhlcndpc2UgdXNlIG9mZnNldCgpXHJcbiAgICAgICAgICAgICAgLy8gY29tcGFyZSAjc2V0RGltZW5zaW9uc1xyXG4gICAgICAgICAgICAgIG9mZnNldFBhcmVudCA9IGZhbHNlXHJcbiAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMub2Zmc2V0UGFyZW50ID0gb2Zmc2V0UGFyZW50XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIHRoaXMub2Zmc2V0UGFyZW50XHJcbiAgICB9LFxyXG4gICAgc2V0UG9pbnRlcjogZnVuY3Rpb24gKGUpIHtcclxuICAgICAgdmFyIHBvaW50ZXIgPSB0aGlzLmdldFBvaW50ZXIoZSlcclxuXHJcbiAgICAgIGlmKHRoaXMuJGdldE9mZnNldFBhcmVudCgpKXtcclxuICAgICAgICB2YXIgcmVsYXRpdmVQb2ludGVyID0gZ2V0UmVsYXRpdmVQb3NpdGlvbihwb2ludGVyLCB0aGlzLiRnZXRPZmZzZXRQYXJlbnQoKSlcclxuICAgICAgICB0aGlzLmxhc3RSZWxhdGl2ZVBvaW50ZXIgPSB0aGlzLnJlbGF0aXZlUG9pbnRlclxyXG4gICAgICAgIHRoaXMucmVsYXRpdmVQb2ludGVyID0gcmVsYXRpdmVQb2ludGVyXHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHRoaXMubGFzdFBvaW50ZXIgPSB0aGlzLnBvaW50ZXJcclxuICAgICAgdGhpcy5wb2ludGVyID0gcG9pbnRlclxyXG4gICAgfSxcclxuICAgIGRpc3RhbmNlTWV0OiBmdW5jdGlvbiAoZSkge1xyXG4gICAgICB2YXIgY3VycmVudFBvaW50ZXIgPSB0aGlzLmdldFBvaW50ZXIoZSlcclxuICAgICAgcmV0dXJuIChNYXRoLm1heChcclxuICAgICAgICBNYXRoLmFicyh0aGlzLnBvaW50ZXIubGVmdCAtIGN1cnJlbnRQb2ludGVyLmxlZnQpLFxyXG4gICAgICAgIE1hdGguYWJzKHRoaXMucG9pbnRlci50b3AgLSBjdXJyZW50UG9pbnRlci50b3ApXHJcbiAgICAgICkgPj0gdGhpcy5vcHRpb25zLmRpc3RhbmNlKVxyXG4gICAgfSxcclxuICAgIGdldFBvaW50ZXI6IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgdmFyIG8gPSBlLm9yaWdpbmFsRXZlbnQgfHwgZS5vcmlnaW5hbEV2ZW50LnRvdWNoZXMgJiYgZS5vcmlnaW5hbEV2ZW50LnRvdWNoZXNbMF1cclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBsZWZ0OiBlLnBhZ2VYIHx8IG8ucGFnZVgsXHJcbiAgICAgICAgdG9wOiBlLnBhZ2VZIHx8IG8ucGFnZVlcclxuICAgICAgfVxyXG4gICAgfSxcclxuICAgIHNldHVwRGVsYXlUaW1lcjogZnVuY3Rpb24gKCkge1xyXG4gICAgICB2YXIgdGhhdCA9IHRoaXNcclxuICAgICAgdGhpcy5kZWxheU1ldCA9ICF0aGlzLm9wdGlvbnMuZGVsYXlcclxuXHJcbiAgICAgIC8vIGluaXQgZGVsYXkgdGltZXIgaWYgbmVlZGVkXHJcbiAgICAgIGlmICghdGhpcy5kZWxheU1ldCkge1xyXG4gICAgICAgIGNsZWFyVGltZW91dCh0aGlzLl9tb3VzZURlbGF5VGltZXIpO1xyXG4gICAgICAgIHRoaXMuX21vdXNlRGVsYXlUaW1lciA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICB0aGF0LmRlbGF5TWV0ID0gdHJ1ZVxyXG4gICAgICAgIH0sIHRoaXMub3B0aW9ucy5kZWxheSlcclxuICAgICAgfVxyXG4gICAgfSxcclxuICAgIHNjcm9sbDogZnVuY3Rpb24gIChlKSB7XHJcbiAgICAgIHRoaXMuY2xlYXJEaW1lbnNpb25zKClcclxuICAgICAgdGhpcy5jbGVhck9mZnNldFBhcmVudCgpIC8vIFRPRE8gaXMgdGhpcyBuZWVkZWQ/XHJcbiAgICB9LFxyXG4gICAgdG9nZ2xlTGlzdGVuZXJzOiBmdW5jdGlvbiAobWV0aG9kKSB7XHJcbiAgICAgIHZhciB0aGF0ID0gdGhpcyxcclxuICAgICAgZXZlbnRzID0gWydkcmFnJywnZHJvcCcsJ3Njcm9sbCddXHJcblxyXG4gICAgICAkLmVhY2goZXZlbnRzLGZ1bmN0aW9uICAoaSxldmVudCkge1xyXG4gICAgICAgIHRoYXQuJGRvY3VtZW50W21ldGhvZF0oZXZlbnROYW1lc1tldmVudF0sIHRoYXRbZXZlbnQgKyAnUHJveHknXSlcclxuICAgICAgfSlcclxuICAgIH0sXHJcbiAgICBjbGVhck9mZnNldFBhcmVudDogZnVuY3Rpb24gKCkge1xyXG4gICAgICB0aGlzLm9mZnNldFBhcmVudCA9IHVuZGVmaW5lZFxyXG4gICAgfSxcclxuICAgIC8vIFJlY3Vyc2l2ZWx5IGNsZWFyIGNvbnRhaW5lciBhbmQgaXRlbSBkaW1lbnNpb25zXHJcbiAgICBjbGVhckRpbWVuc2lvbnM6IGZ1bmN0aW9uICAoKSB7XHJcbiAgICAgIHRoaXMudHJhdmVyc2UoZnVuY3Rpb24ob2JqZWN0KXtcclxuICAgICAgICBvYmplY3QuX2NsZWFyRGltZW5zaW9ucygpXHJcbiAgICAgIH0pXHJcbiAgICB9LFxyXG4gICAgdHJhdmVyc2U6IGZ1bmN0aW9uKGNhbGxiYWNrKSB7XHJcbiAgICAgIGNhbGxiYWNrKHRoaXMpXHJcbiAgICAgIHZhciBpID0gdGhpcy5jb250YWluZXJzLmxlbmd0aFxyXG4gICAgICB3aGlsZShpLS0pe1xyXG4gICAgICAgIHRoaXMuY29udGFpbmVyc1tpXS50cmF2ZXJzZShjYWxsYmFjaylcclxuICAgICAgfVxyXG4gICAgfSxcclxuICAgIF9jbGVhckRpbWVuc2lvbnM6IGZ1bmN0aW9uKCl7XHJcbiAgICAgIHRoaXMuY29udGFpbmVyRGltZW5zaW9ucyA9IHVuZGVmaW5lZFxyXG4gICAgfSxcclxuICAgIF9kZXN0cm95OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgIGNvbnRhaW5lckdyb3Vwc1t0aGlzLm9wdGlvbnMuZ3JvdXBdID0gdW5kZWZpbmVkXHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBDb250YWluZXIoZWxlbWVudCwgb3B0aW9ucykge1xyXG4gICAgdGhpcy5lbCA9IGVsZW1lbnRcclxuICAgIHRoaXMub3B0aW9ucyA9ICQuZXh0ZW5kKCB7fSwgY29udGFpbmVyRGVmYXVsdHMsIG9wdGlvbnMpXHJcblxyXG4gICAgdGhpcy5ncm91cCA9IENvbnRhaW5lckdyb3VwLmdldCh0aGlzLm9wdGlvbnMpXHJcbiAgICB0aGlzLnJvb3RHcm91cCA9IHRoaXMub3B0aW9ucy5yb290R3JvdXAgfHwgdGhpcy5ncm91cFxyXG4gICAgdGhpcy5oYW5kbGUgPSB0aGlzLnJvb3RHcm91cC5vcHRpb25zLmhhbmRsZSB8fCB0aGlzLnJvb3RHcm91cC5vcHRpb25zLml0ZW1TZWxlY3RvclxyXG5cclxuICAgIHZhciBpdGVtUGF0aCA9IHRoaXMucm9vdEdyb3VwLm9wdGlvbnMuaXRlbVBhdGhcclxuICAgIHRoaXMudGFyZ2V0ID0gaXRlbVBhdGggPyB0aGlzLmVsLmZpbmQoaXRlbVBhdGgpIDogdGhpcy5lbFxyXG5cclxuICAgIHRoaXMudGFyZ2V0Lm9uKGV2ZW50TmFtZXMuc3RhcnQsIHRoaXMuaGFuZGxlLCAkLnByb3h5KHRoaXMuZHJhZ0luaXQsIHRoaXMpKVxyXG5cclxuICAgIGlmKHRoaXMub3B0aW9ucy5kcm9wKVxyXG4gICAgICB0aGlzLmdyb3VwLmNvbnRhaW5lcnMucHVzaCh0aGlzKVxyXG4gIH1cclxuXHJcbiAgQ29udGFpbmVyLnByb3RvdHlwZSA9IHtcclxuICAgIGRyYWdJbml0OiBmdW5jdGlvbiAgKGUpIHtcclxuICAgICAgdmFyIHJvb3RHcm91cCA9IHRoaXMucm9vdEdyb3VwXHJcblxyXG4gICAgICBpZiggIXRoaXMuZGlzYWJsZWQgJiZcclxuICAgICAgICAgICFyb290R3JvdXAuZHJhZ0luaXREb25lICYmXHJcbiAgICAgICAgICB0aGlzLm9wdGlvbnMuZHJhZyAmJlxyXG4gICAgICAgICAgdGhpcy5pc1ZhbGlkRHJhZyhlKSkge1xyXG4gICAgICAgIHJvb3RHcm91cC5kcmFnSW5pdChlLCB0aGlzKVxyXG4gICAgICB9XHJcbiAgICB9LFxyXG4gICAgaXNWYWxpZERyYWc6IGZ1bmN0aW9uKGUpIHtcclxuICAgICAgcmV0dXJuIGUud2hpY2ggPT0gMSB8fFxyXG4gICAgICAgIGUudHlwZSA9PSBcInRvdWNoc3RhcnRcIiAmJiBlLm9yaWdpbmFsRXZlbnQudG91Y2hlcy5sZW5ndGggPT0gMVxyXG4gICAgfSxcclxuICAgIHNlYXJjaFZhbGlkVGFyZ2V0OiBmdW5jdGlvbiAgKHBvaW50ZXIsIGxhc3RQb2ludGVyKSB7XHJcbiAgICAgIHZhciBkaXN0YW5jZXMgPSBzb3J0QnlEaXN0YW5jZURlc2ModGhpcy5nZXRJdGVtRGltZW5zaW9ucygpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50ZXIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFzdFBvaW50ZXIpLFxyXG4gICAgICBpID0gZGlzdGFuY2VzLmxlbmd0aCxcclxuICAgICAgcm9vdEdyb3VwID0gdGhpcy5yb290R3JvdXAsXHJcbiAgICAgIHZhbGlkVGFyZ2V0ID0gIXJvb3RHcm91cC5vcHRpb25zLmlzVmFsaWRUYXJnZXQgfHxcclxuICAgICAgICByb290R3JvdXAub3B0aW9ucy5pc1ZhbGlkVGFyZ2V0KHJvb3RHcm91cC5pdGVtLCB0aGlzKVxyXG5cclxuICAgICAgaWYoIWkgJiYgdmFsaWRUYXJnZXQpe1xyXG4gICAgICAgIHJvb3RHcm91cC5tb3ZlUGxhY2Vob2xkZXIodGhpcywgdGhpcy50YXJnZXQsIFwiYXBwZW5kXCIpXHJcbiAgICAgICAgcmV0dXJuIHRydWVcclxuICAgICAgfSBlbHNlXHJcbiAgICAgICAgd2hpbGUoaS0tKXtcclxuICAgICAgICAgIHZhciBpbmRleCA9IGRpc3RhbmNlc1tpXVswXSxcclxuICAgICAgICAgIGRpc3RhbmNlID0gZGlzdGFuY2VzW2ldWzFdXHJcbiAgICAgICAgICBpZighZGlzdGFuY2UgJiYgdGhpcy5oYXNDaGlsZEdyb3VwKGluZGV4KSl7XHJcbiAgICAgICAgICAgIHZhciBmb3VuZCA9IHRoaXMuZ2V0Q29udGFpbmVyR3JvdXAoaW5kZXgpLnNlYXJjaFZhbGlkVGFyZ2V0KHBvaW50ZXIsIGxhc3RQb2ludGVyKVxyXG4gICAgICAgICAgICBpZihmb3VuZClcclxuICAgICAgICAgICAgICByZXR1cm4gdHJ1ZVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgZWxzZSBpZih2YWxpZFRhcmdldCl7XHJcbiAgICAgICAgICAgIHRoaXMubW92ZVBsYWNlaG9sZGVyKGluZGV4LCBwb2ludGVyKVxyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH0sXHJcbiAgICBtb3ZlUGxhY2Vob2xkZXI6IGZ1bmN0aW9uICAoaW5kZXgsIHBvaW50ZXIpIHtcclxuICAgICAgdmFyIGl0ZW0gPSAkKHRoaXMuaXRlbXNbaW5kZXhdKSxcclxuICAgICAgZGltID0gdGhpcy5pdGVtRGltZW5zaW9uc1tpbmRleF0sXHJcbiAgICAgIG1ldGhvZCA9IFwiYWZ0ZXJcIixcclxuICAgICAgd2lkdGggPSBpdGVtLm91dGVyV2lkdGgoKSxcclxuICAgICAgaGVpZ2h0ID0gaXRlbS5vdXRlckhlaWdodCgpLFxyXG4gICAgICBvZmZzZXQgPSBpdGVtLm9mZnNldCgpLFxyXG4gICAgICBzYW1lUmVzdWx0Qm94ID0ge1xyXG4gICAgICAgIGxlZnQ6IG9mZnNldC5sZWZ0LFxyXG4gICAgICAgIHJpZ2h0OiBvZmZzZXQubGVmdCArIHdpZHRoLFxyXG4gICAgICAgIHRvcDogb2Zmc2V0LnRvcCxcclxuICAgICAgICBib3R0b206IG9mZnNldC50b3AgKyBoZWlnaHRcclxuICAgICAgfVxyXG4gICAgICBpZih0aGlzLm9wdGlvbnMudmVydGljYWwpe1xyXG4gICAgICAgIHZhciB5Q2VudGVyID0gKGRpbVsyXSArIGRpbVszXSkgLyAyLFxyXG4gICAgICAgIGluVXBwZXJIYWxmID0gcG9pbnRlci50b3AgPD0geUNlbnRlclxyXG4gICAgICAgIGlmKGluVXBwZXJIYWxmKXtcclxuICAgICAgICAgIG1ldGhvZCA9IFwiYmVmb3JlXCJcclxuICAgICAgICAgIHNhbWVSZXN1bHRCb3guYm90dG9tIC09IGhlaWdodCAvIDJcclxuICAgICAgICB9IGVsc2VcclxuICAgICAgICAgIHNhbWVSZXN1bHRCb3gudG9wICs9IGhlaWdodCAvIDJcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB2YXIgeENlbnRlciA9IChkaW1bMF0gKyBkaW1bMV0pIC8gMixcclxuICAgICAgICBpbkxlZnRIYWxmID0gcG9pbnRlci5sZWZ0IDw9IHhDZW50ZXJcclxuICAgICAgICBpZihpbkxlZnRIYWxmKXtcclxuICAgICAgICAgIG1ldGhvZCA9IFwiYmVmb3JlXCJcclxuICAgICAgICAgIHNhbWVSZXN1bHRCb3gucmlnaHQgLT0gd2lkdGggLyAyXHJcbiAgICAgICAgfSBlbHNlXHJcbiAgICAgICAgICBzYW1lUmVzdWx0Qm94LmxlZnQgKz0gd2lkdGggLyAyXHJcbiAgICAgIH1cclxuICAgICAgaWYodGhpcy5oYXNDaGlsZEdyb3VwKGluZGV4KSlcclxuICAgICAgICBzYW1lUmVzdWx0Qm94ID0gZW1wdHlCb3hcclxuICAgICAgdGhpcy5yb290R3JvdXAubW92ZVBsYWNlaG9sZGVyKHRoaXMsIGl0ZW0sIG1ldGhvZCwgc2FtZVJlc3VsdEJveClcclxuICAgIH0sXHJcbiAgICBnZXRJdGVtRGltZW5zaW9uczogZnVuY3Rpb24gICgpIHtcclxuICAgICAgaWYoIXRoaXMuaXRlbURpbWVuc2lvbnMpe1xyXG4gICAgICAgIHRoaXMuaXRlbXMgPSB0aGlzLiRnZXRDaGlsZHJlbih0aGlzLmVsLCBcIml0ZW1cIikuZmlsdGVyKFxyXG4gICAgICAgICAgXCI6bm90KC5cIiArIHRoaXMuZ3JvdXAub3B0aW9ucy5wbGFjZWhvbGRlckNsYXNzICsgXCIsIC5cIiArIHRoaXMuZ3JvdXAub3B0aW9ucy5kcmFnZ2VkQ2xhc3MgKyBcIilcIlxyXG4gICAgICAgICkuZ2V0KClcclxuICAgICAgICBzZXREaW1lbnNpb25zKHRoaXMuaXRlbXMsIHRoaXMuaXRlbURpbWVuc2lvbnMgPSBbXSwgdGhpcy5vcHRpb25zLnRvbGVyYW5jZSlcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gdGhpcy5pdGVtRGltZW5zaW9uc1xyXG4gICAgfSxcclxuICAgIGdldEl0ZW1PZmZzZXRQYXJlbnQ6IGZ1bmN0aW9uICAoKSB7XHJcbiAgICAgIHZhciBvZmZzZXRQYXJlbnQsXHJcbiAgICAgIGVsID0gdGhpcy5lbFxyXG4gICAgICAvLyBTaW5jZSBlbCBtaWdodCBiZSBlbXB0eSB3ZSBoYXZlIHRvIGNoZWNrIGVsIGl0c2VsZiBhbmRcclxuICAgICAgLy8gY2FuIG5vdCBkbyBzb21ldGhpbmcgbGlrZSBlbC5jaGlsZHJlbigpLmZpcnN0KCkub2Zmc2V0UGFyZW50KClcclxuICAgICAgaWYoZWwuY3NzKFwicG9zaXRpb25cIikgPT09IFwicmVsYXRpdmVcIiB8fCBlbC5jc3MoXCJwb3NpdGlvblwiKSA9PT0gXCJhYnNvbHV0ZVwiICB8fCBlbC5jc3MoXCJwb3NpdGlvblwiKSA9PT0gXCJmaXhlZFwiKVxyXG4gICAgICAgIG9mZnNldFBhcmVudCA9IGVsXHJcbiAgICAgIGVsc2VcclxuICAgICAgICBvZmZzZXRQYXJlbnQgPSBlbC5vZmZzZXRQYXJlbnQoKVxyXG4gICAgICByZXR1cm4gb2Zmc2V0UGFyZW50XHJcbiAgICB9LFxyXG4gICAgaGFzQ2hpbGRHcm91cDogZnVuY3Rpb24gKGluZGV4KSB7XHJcbiAgICAgIHJldHVybiB0aGlzLm9wdGlvbnMubmVzdGVkICYmIHRoaXMuZ2V0Q29udGFpbmVyR3JvdXAoaW5kZXgpXHJcbiAgICB9LFxyXG4gICAgZ2V0Q29udGFpbmVyR3JvdXA6IGZ1bmN0aW9uICAoaW5kZXgpIHtcclxuICAgICAgdmFyIGNoaWxkR3JvdXAgPSAkLmRhdGEodGhpcy5pdGVtc1tpbmRleF0sIHN1YkNvbnRhaW5lcktleSlcclxuICAgICAgaWYoIGNoaWxkR3JvdXAgPT09IHVuZGVmaW5lZCl7XHJcbiAgICAgICAgdmFyIGNoaWxkQ29udGFpbmVycyA9IHRoaXMuJGdldENoaWxkcmVuKHRoaXMuaXRlbXNbaW5kZXhdLCBcImNvbnRhaW5lclwiKVxyXG4gICAgICAgIGNoaWxkR3JvdXAgPSBmYWxzZVxyXG5cclxuICAgICAgICBpZihjaGlsZENvbnRhaW5lcnNbMF0pe1xyXG4gICAgICAgICAgdmFyIG9wdGlvbnMgPSAkLmV4dGVuZCh7fSwgdGhpcy5vcHRpb25zLCB7XHJcbiAgICAgICAgICAgIHJvb3RHcm91cDogdGhpcy5yb290R3JvdXAsXHJcbiAgICAgICAgICAgIGdyb3VwOiBncm91cENvdW50ZXIgKytcclxuICAgICAgICAgIH0pXHJcbiAgICAgICAgICBjaGlsZEdyb3VwID0gY2hpbGRDb250YWluZXJzW3BsdWdpbk5hbWVdKG9wdGlvbnMpLmRhdGEocGx1Z2luTmFtZSkuZ3JvdXBcclxuICAgICAgICB9XHJcbiAgICAgICAgJC5kYXRhKHRoaXMuaXRlbXNbaW5kZXhdLCBzdWJDb250YWluZXJLZXksIGNoaWxkR3JvdXApXHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIGNoaWxkR3JvdXBcclxuICAgIH0sXHJcbiAgICAkZ2V0Q2hpbGRyZW46IGZ1bmN0aW9uIChwYXJlbnQsIHR5cGUpIHtcclxuICAgICAgdmFyIG9wdGlvbnMgPSB0aGlzLnJvb3RHcm91cC5vcHRpb25zLFxyXG4gICAgICBwYXRoID0gb3B0aW9uc1t0eXBlICsgXCJQYXRoXCJdLFxyXG4gICAgICBzZWxlY3RvciA9IG9wdGlvbnNbdHlwZSArIFwiU2VsZWN0b3JcIl1cclxuXHJcbiAgICAgIHBhcmVudCA9ICQocGFyZW50KVxyXG4gICAgICBpZihwYXRoKVxyXG4gICAgICAgIHBhcmVudCA9IHBhcmVudC5maW5kKHBhdGgpXHJcblxyXG4gICAgICByZXR1cm4gcGFyZW50LmNoaWxkcmVuKHNlbGVjdG9yKVxyXG4gICAgfSxcclxuICAgIF9zZXJpYWxpemU6IGZ1bmN0aW9uIChwYXJlbnQsIGlzQ29udGFpbmVyKSB7XHJcbiAgICAgIHZhciB0aGF0ID0gdGhpcyxcclxuICAgICAgY2hpbGRUeXBlID0gaXNDb250YWluZXIgPyBcIml0ZW1cIiA6IFwiY29udGFpbmVyXCIsXHJcblxyXG4gICAgICBjaGlsZHJlbiA9IHRoaXMuJGdldENoaWxkcmVuKHBhcmVudCwgY2hpbGRUeXBlKS5ub3QodGhpcy5vcHRpb25zLmV4Y2x1ZGUpLm1hcChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoYXQuX3NlcmlhbGl6ZSgkKHRoaXMpLCAhaXNDb250YWluZXIpXHJcbiAgICAgIH0pLmdldCgpXHJcblxyXG4gICAgICByZXR1cm4gdGhpcy5yb290R3JvdXAub3B0aW9ucy5zZXJpYWxpemUocGFyZW50LCBjaGlsZHJlbiwgaXNDb250YWluZXIpXHJcbiAgICB9LFxyXG4gICAgdHJhdmVyc2U6IGZ1bmN0aW9uKGNhbGxiYWNrKSB7XHJcbiAgICAgICQuZWFjaCh0aGlzLml0ZW1zIHx8IFtdLCBmdW5jdGlvbihpdGVtKXtcclxuICAgICAgICB2YXIgZ3JvdXAgPSAkLmRhdGEodGhpcywgc3ViQ29udGFpbmVyS2V5KVxyXG4gICAgICAgIGlmKGdyb3VwKVxyXG4gICAgICAgICAgZ3JvdXAudHJhdmVyc2UoY2FsbGJhY2spXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgY2FsbGJhY2sodGhpcylcclxuICAgIH0sXHJcbiAgICBfY2xlYXJEaW1lbnNpb25zOiBmdW5jdGlvbiAgKCkge1xyXG4gICAgICB0aGlzLml0ZW1EaW1lbnNpb25zID0gdW5kZWZpbmVkXHJcbiAgICB9LFxyXG4gICAgX2Rlc3Ryb3k6IGZ1bmN0aW9uKCkge1xyXG4gICAgICB2YXIgdGhhdCA9IHRoaXM7XHJcblxyXG4gICAgICB0aGlzLnRhcmdldC5vZmYoZXZlbnROYW1lcy5zdGFydCwgdGhpcy5oYW5kbGUpO1xyXG4gICAgICB0aGlzLmVsLnJlbW92ZURhdGEocGx1Z2luTmFtZSlcclxuXHJcbiAgICAgIGlmKHRoaXMub3B0aW9ucy5kcm9wKVxyXG4gICAgICAgIHRoaXMuZ3JvdXAuY29udGFpbmVycyA9ICQuZ3JlcCh0aGlzLmdyb3VwLmNvbnRhaW5lcnMsIGZ1bmN0aW9uKHZhbCl7XHJcbiAgICAgICAgICByZXR1cm4gdmFsICE9IHRoYXRcclxuICAgICAgICB9KVxyXG5cclxuICAgICAgJC5lYWNoKHRoaXMuaXRlbXMgfHwgW10sIGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgJC5yZW1vdmVEYXRhKHRoaXMsIHN1YkNvbnRhaW5lcktleSlcclxuICAgICAgfSlcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHZhciBBUEkgPSB7XHJcbiAgICBlbmFibGU6IGZ1bmN0aW9uKCkge1xyXG4gICAgICB0aGlzLnRyYXZlcnNlKGZ1bmN0aW9uKG9iamVjdCl7XHJcbiAgICAgICAgb2JqZWN0LmRpc2FibGVkID0gZmFsc2VcclxuICAgICAgfSlcclxuICAgIH0sXHJcbiAgICBkaXNhYmxlOiBmdW5jdGlvbiAoKXtcclxuICAgICAgdGhpcy50cmF2ZXJzZShmdW5jdGlvbihvYmplY3Qpe1xyXG4gICAgICAgIG9iamVjdC5kaXNhYmxlZCA9IHRydWVcclxuICAgICAgfSlcclxuICAgIH0sXHJcbiAgICBzZXJpYWxpemU6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgcmV0dXJuIHRoaXMuX3NlcmlhbGl6ZSh0aGlzLmVsLCB0cnVlKVxyXG4gICAgfSxcclxuICAgIHJlZnJlc2g6IGZ1bmN0aW9uKCkge1xyXG4gICAgICB0aGlzLnRyYXZlcnNlKGZ1bmN0aW9uKG9iamVjdCl7XHJcbiAgICAgICAgb2JqZWN0Ll9jbGVhckRpbWVuc2lvbnMoKVxyXG4gICAgICB9KVxyXG4gICAgfSxcclxuICAgIGRlc3Ryb3k6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgdGhpcy50cmF2ZXJzZShmdW5jdGlvbihvYmplY3Qpe1xyXG4gICAgICAgIG9iamVjdC5fZGVzdHJveSgpO1xyXG4gICAgICB9KVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgJC5leHRlbmQoQ29udGFpbmVyLnByb3RvdHlwZSwgQVBJKVxyXG5cclxuICAvKipcclxuICAgKiBqUXVlcnkgQVBJXHJcbiAgICpcclxuICAgKiBQYXJhbWV0ZXJzIGFyZVxyXG4gICAqICAgZWl0aGVyIG9wdGlvbnMgb24gaW5pdFxyXG4gICAqICAgb3IgYSBtZXRob2QgbmFtZSBmb2xsb3dlZCBieSBhcmd1bWVudHMgdG8gcGFzcyB0byB0aGUgbWV0aG9kXHJcbiAgICovXHJcbiAgJC5mbltwbHVnaW5OYW1lXSA9IGZ1bmN0aW9uKG1ldGhvZE9yT3B0aW9ucykge1xyXG4gICAgdmFyIGFyZ3MgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpXHJcblxyXG4gICAgcmV0dXJuIHRoaXMubWFwKGZ1bmN0aW9uKCl7XHJcbiAgICAgIHZhciAkdCA9ICQodGhpcyksXHJcbiAgICAgIG9iamVjdCA9ICR0LmRhdGEocGx1Z2luTmFtZSlcclxuXHJcbiAgICAgIGlmKG9iamVjdCAmJiBBUElbbWV0aG9kT3JPcHRpb25zXSlcclxuICAgICAgICByZXR1cm4gQVBJW21ldGhvZE9yT3B0aW9uc10uYXBwbHkob2JqZWN0LCBhcmdzKSB8fCB0aGlzXHJcbiAgICAgIGVsc2UgaWYoIW9iamVjdCAmJiAobWV0aG9kT3JPcHRpb25zID09PSB1bmRlZmluZWQgfHxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlb2YgbWV0aG9kT3JPcHRpb25zID09PSBcIm9iamVjdFwiKSlcclxuICAgICAgICAkdC5kYXRhKHBsdWdpbk5hbWUsIG5ldyBDb250YWluZXIoJHQsIG1ldGhvZE9yT3B0aW9ucykpXHJcblxyXG4gICAgICByZXR1cm4gdGhpc1xyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbn0oalF1ZXJ5LCB3aW5kb3csICdzb3J0YWJsZScpO1xyXG4iXX0="}